<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Driver</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      color: #333;
      padding: 20px;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #d32f2f;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    input {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
    }
    input:focus {
      border-color: #d32f2f;
    }
    button {
      padding: 12px 20px;
      background: #d32f2f;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover:not(:disabled) {
      background: #b71c1c;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #map {
      width: 100%;
      height: 300px;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin-top: 15px;
      background: #e8f5e9;
    }
    .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      font-size: 14px;
      display: none;
    }
    .status.connecting { background: #fff8e1; color: #ff8f00; display: block; }
    .status.tracking { background: #e8f5e9; color: #2e7d32; display: block; }
    .status.error { background: #ffebee; color: #c62828; display: block; }
  </style>
</head>
<body>

<div class="container">
  <h1>Track Your Driver</h1>
  <div class="input-group">
    <input type="text" id="orderId" placeholder="Enter Order ID (e.g. ORD123)" />
    <button id="trackBtn">Track</button>
  </div>
  <div id="map"></div>
  <div id="status" class="status">No location selected.</div>
</div>

<!-- Google Maps API - Replace YOUR_API_KEY with your actual API key -->
<script>
  const API_KEY = 'AIzaSyB9sNhi824hNncjfW7HHzaI_s8JtWGfM0Q  '; // Replace with your API key
  const DUMMY_ORDER_ID = 'ORDER1234567890';

  let map, driverMarker, customerMarker;
  let tracking = false;
  let intervalId = null;
  let customerLat = 37.7850, customerLng = -122.4383; // Default

  // Initialize map with default center
  function initMap() {
    // Default center (if no specific order)
    let centerCoords = { lat: 0, lng: 0 };

    // Check if current input triggers Cape Town
    const currentOrderId = document.getElementById('orderId').value.trim();
    if (currentOrderId === DUMMY_ORDER_ID) {
      centerCoords = { lat: -33.9249, lng: 18.4241 }; // Cape Town
    }

    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 14,
      center: centerCoords,
      mapTypeId: 'roadmap',
      disableDefaultUI: false,
      zoomControl: true,
    });

    // Customer Marker
    customerMarker = new google.maps.Marker({
      map: map,
      title: "You are here",
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 9,
        fillColor: '#4285f4',
        fillOpacity: 1,
        strokeColor: '#fff',
        strokeWeight: 2
      }
    });

    // Driver Marker
    driverMarker = new google.maps.Marker({
      map: map,
      title: "Driver",
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 11,
        fillColor: '#d32f2f',
        fillOpacity: 1,
        strokeColor: '#fff',
        strokeWeight: 3
      }
    });

    updateCustomerMarker();
  }

  function updateCustomerMarker() {
    if (customerMarker) {
      customerMarker.setPosition({ lat: customerLat, lng: customerLng });
      map.panTo({ lat: customerLat, lng: customerLng });
    }
  }

  function updateDriverLocation(lat, lng) {
    const pos = { lat: parseFloat(lat), lng: parseFloat(lng) };
    driverMarker.setPosition(pos);
    map.panTo(pos);
    map.setZoom(15);
  }

  // Geolocation for customer
  function updateCustomerLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          customerLat = pos.coords.latitude;
          customerLng = pos.coords.longitude;
          updateCustomerMarker();
        },
        () => console.warn("Geolocation denied")
      );
    }
  }

  // Start tracking
 document.addEventListener('DOMContentLoaded', () => {
    const orderInput = document.getElementById('orderId');
    const trackBtn = document.getElementById('trackBtn');
    const statusEl = document.getElementById('status');

    // Load Google Maps
    window.initMap = initMap;

    // Load Google Maps script
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&callback=initMap`;
    script.async = true;
    document.head.appendChild(script);

    // Update customer location periodically
    setInterval(updateCustomerLocation, 15000);
    updateCustomerLocation();

    const startTracking = () => {
      if (tracking) return; // Already tracking

      const orderId = orderInput.value.trim();

      // Initialize map with correct center based on orderId
      // Re-initialize map
      initMap();

      // Set status
      statusEl.className = 'status connecting';
      statusEl.textContent = 'Connecting to driver...';

      // Start polling driver location
      intervalId = setInterval(() => pollDriverLocation(orderId), 3000);
      tracking = true;
      document.getElementById('trackBtn').disabled = true;
      document.getElementById('trackBtn').textContent = 'Tracking...';
    };

    const pollDriverLocation = async (orderId) => {
      try {
        // Replace API_URL with your server that returns driver location for the order
        // For demo, simulate with dummy data if orderId matches dummy
        if (orderId === DUMMY_ORDER_ID) {
          // Simulate driver movement around Cape Town
          const lat = -33.9249 + Math.random() * 0.02; // Small variation
          const lng = 18.4241 + Math.random() * 0.02;
          updateDriverLocation(lat, lng);
          document.getElementById('status').className = 'status tracking';
          document.getElementById('status').textContent = 'Driver is moving...';
        } else {
          // For other IDs, simulate no driver
          throw new Error('Driver not found');
        }
      } catch (err) {
        console.warn('Error:', err);
        document.getElementById('status').className = 'status error';
        document.getElementById('status').textContent = 'Driver not found or offline.';
        clearInterval(intervalId);
        tracking = false;
        document.getElementById('trackBtn').disabled = false;
        document.getElementById('trackBtn').textContent = 'Track';
      }
    };

    document.getElementById('trackBtn').addEventListener('click', startTracking);
    document.getElementById('orderId').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') startTracking();
    });
  });
</script>
</body>
</html>