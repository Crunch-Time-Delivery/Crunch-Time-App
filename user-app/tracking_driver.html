<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Driver</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      color: #333;
      padding: 20px;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #d32f2f;
      margin-bottom: 20px;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    input {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      padding: 12px 20px;
      background: #d32f2f;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #map {
      width: 100%;
      height: 300px;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin-top: 15px;
      background: #e8f5e9;
    }
    .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      font-size: 14px;
      display: none;
    }
    .status.connecting { background: #fff8e1; color: #ff8f00; display: block; }
    .status.tracking { background: #e8f5e9; color: #2e7d32; display: block; }
    .status.error { background: #ffebee; color: #c62828; display: block; }
  </style>
</head>
<body>

<div class="container">
  <h1>Track Your Driver</h1>

  <div class="input-group">
    <input type="text" id="orderId" placeholder="Enter Order ID" />
    <button id="trackBtn">Track</button>
  </div>

  <div id="map"></div>
  <div id="status" class="status"></div>
</div>

<script>
  // === CONFIG ===
  const API_URL = 'https://your-api.example.com/location'; // CHANGE THIS!
  // Example: https://your-api.com/location?order=ORD123

  // === DOM ===
  const orderInput = document.getElementById('orderId');
  const trackBtn = document.getElementById('trackBtn');
  const statusEl = document.getElementById('status');
  const canvas = document.getElementById('map');
  const ctx = canvas.getContext('2d');

  let tracking = false;
  let intervalId = null;
  let driver = { x: 50, y: 50 }; // % of canvas

  // Resize canvas
  function resizeCanvas() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Draw map + driver
  function drawMap() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Simple road grid
    ctx.strokeStyle = '#aaa';
    ctx.lineWidth = 2;
    for (let i = 0; i <= canvas.width; i += 60) {
      ctx.beginPath();
      ctx.moveTo(i, 0);
      ctx.lineTo(i, canvas.height);
      ctx.stroke();
    }
    for (let i = 0; i <= canvas.height; i += 60) {
      ctx.beginPath();
      ctx.moveTo(0, i);
      ctx.lineTo(canvas.width, i);
      ctx.stroke();
    }

    // Driver (red circle)
    const dx = (driver.x / 100) * canvas.width;
    const dy = (driver.y / 100) * canvas.height;
    ctx.fillStyle = '#d32f2f';
    ctx.beginPath();
    ctx.arc(dx, dy, 12, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 3;
    ctx.stroke();
  }

  // Fetch driver location from your backend
  async function fetchLocation(orderId) {
    try {
      const res = await fetch(`${API_URL}?order=${encodeURIComponent(orderId)}`);
      if (!res.ok) throw new Error('Not found');
      const data = await res.json();
      if (data.lat !== undefined && data.lng !== undefined) {
        // Simple mapping: lat/lng â†’ % of canvas
        driver.x = ((data.lng + 122.55) / 0.3) * 100; // adjust range
        driver.y = ((37.85 - data.lat) / 0.15) * 100;
        driver.x = Math.max(5, Math.min(95, driver.x));
        driver.y = Math.max(5, Math.min(95, driver.y));
      }
      drawMap();
    } catch (err) {
      console.warn('Location fetch failed:', err);
      // Keep last position
    }
  }

  // Start tracking
  trackBtn.addEventListener('click', () => {
    const orderId = orderInput.value.trim();
    if (!orderId || tracking) return;

    tracking = true;
    trackBtn.disabled = true;
    trackBtn.textContent = 'Tracking...';
    statusEl.className = 'status connecting';
    statusEl.textContent = 'Connecting...';
    statusEl.style.display = 'block';

    drawMap(); // initial draw

    // Poll every 3 seconds
    intervalId = setInterval(() => {
      fetchLocation(orderId);
    }, 3000);

    // First fetch immediately
    fetchLocation(orderId).then(() => {
      statusEl.className = 'status tracking';
      statusEl.textContent = 'Driver is moving...';
    }).catch(() => {
      statusEl.className = 'status error';
      statusEl.textContent = 'Order not found or no driver yet.';
      stopTracking();
    });
  });

  function stopTracking() {
    clearInterval(intervalId);
    tracking = false;
    trackBtn.disabled = false;
    trackBtn.textContent = 'Track';
  }

  // Press Enter to track
  orderInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') trackBtn.click();
  });

  // Initial draw
  drawMap();

var map;
var mark;
var initialize = function() {
  map  = new google.maps.Map(document.getElementById('map-canvas'), {center:{lat:lat,lng:lng},zoom:12});
  mark = new google.maps.Marker({position:{lat:lat, lng:lng}, map:map});
};
window.initialize = initialize;
</script>

</body>
</html>