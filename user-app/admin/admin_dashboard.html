<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Dashboard</title>
<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding-top:70px;
  }

  /* Top header with CRUNCHTIME */
  .top-header {
    width: 100%;
    background: #fff;
    padding: 10px 20px;
    font-weight: bold;
    font-size: 24px;
    color: red;
    text-align: center;
    border-bottom: 1px solid #ccc;
  }

  /* Fixed Header styles */
  .header {
    display:flex; justify-content:space-between; align-items:center;
    background:red; padding:10px 20px; color:#fff; position:fixed; top:0; width:100%; height:60px; z-index:1000; border-bottom:1px solid #ccc;
  }

  /* Menu container styles */
  .menu-container {
    position:relative;
  }
  #menuDropdown {
    display:none;
    position:absolute; top:100%; left:0; background:#fff; border:1px solid #ccc; padding:5px; box-shadow:0 2px 8px rgba(0,0,0,0.2);
    z-index: 1001; width:200px;
  }
  #menuDropdown button {
    display:block; width:100%; padding:8px; border:none; background:none; cursor:pointer; text-align:left;
  }

  /* Profile section styles */
  .profile-section {
    display:flex; align-items:center; cursor:pointer; margin-left:auto;
  }
  #profileImage {
    border-radius:50%; width:40px; height:40px; object-fit:cover;
  }
  .admin-name {
    margin-left:10px;
  }

  /* Sections hidden/shown */
  .section { display:none; padding-top:70px; }
  .section.active { display:block; }

  /* Buttons styling */
  button {
    padding:8px 12px; border:none; border-radius:4px; cursor:pointer; margin:5px;
  }
  .btn-primary { background:#4CAF50; color:#fff; }
  .btn-primary:hover { background:#45a049; }

  /* Modal overlays for login, admin update, role view */
  .modal {
    display: flex; align-items: center; justify-content: center;
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); z-index:9999;
  }
  .modal-box {
    background:#fff; padding:30px; border-radius:8px; width:400px; max-height:80%; overflow-y:auto;
  }

  /* Additional styling for dashboard elements */
  h2 { margin-bottom:10px; }

  /* Filter dropdown style */
  #filterDropdown {
    display: none; position: absolute; top: 100%; left: 0; background: #fff; border: 1px solid #ccc; padding: 10px; z-index: 1002; width: 200px;
  }
  #filterDropdown button {
    display: block; width: 100%; padding: 8px; border: none; background: none; cursor: pointer; text-align: left;
  }

  /* Chart container styles */
  .chart-container {
    display: flex; flex-direction: column; align-items: center; margin-top: 20px;
  }
  canvas {
    max-width: 400px; margin: 20px 0;
  }

  /* Role Buttons */
  .role-buttons {
    display: flex; gap: 10px;
  }
  /* Style for percentage change texts */
  .percentage-change {
    font-size: 14px; margin-left: 10px;
  }
  .chart-container {
    padding: 20px; /* Adjusted for clarity */
  }
</style>
</head>
<body>

<!-- ================== LOGIN MODAL ================== -->
<div id="loginModal" class="modal" style="display:flex;">
  <div class="modal-box">
    <div class="modal-content" style="max-width: 300px; padding:20px; text-align:center; display:flex; flex-direction:column; align-items:center;">
      <img src="Screenshot (254).jpg" alt="Welcome Image" style="width:250px; height:auto; margin-bottom:20px;">
      <h2 style="color:gray;">Welcome</h2>
      <h3>Admin Login</h3>
      <label>Username</label>
      <input type="text" id="username" placeholder="Username" style="width:100%; margin-bottom:10px; padding:8px;"/>
      <label>Password</label>
      <input type="password" id="password" placeholder="Password" style="width:100%; margin-bottom:10px; padding:8px;"/>
      <button  style="width:100%;background-color:red" onclick="verifyLogin()">Login</button>
    </div>
  </div>
</div>

<!-- ================== Admin Credential Popup ================== -->
<div id="adminPopup" class="modal" style="display:none;">
  <div class="modal-box" style="width:400px;">
     <img src="Screenshot (254).jpg" alt="Welcome Image" style="width:250px; height:auto; margin-bottom:20px;">
    <h3>Admin Update</h3>
    <div>
      <label>Change Username:</label>
      <input type="text" id="newUsername" style="width:100%; margin-bottom:10px;"/>
    </div>
    <div>
      <label>Change Password:</label>
      <input type="password" id="newPassword" style="width:100%; margin-bottom:10px;"/>
    </div>
    <button onclick="saveAdminCredentials()">Save Credentials</button>
    <hr style="margin:10px 0;"/>
    <h4>Add New Admin</h4>
    <div>
      <label>Email:</label>
      <input type="email" id="newAdminEmail" style="width:100%; margin-bottom:10px;"/>
    </div>
    <div>
      <label>Username:</label>
      <input type="text" id="newAdminUsername" style="width:100%; margin-bottom:10px;"/>
    </div>
    <div>
      <label>Password:</label>
      <input type="password" id="newAdminPassword" style="width:100%; margin-bottom:10px;"/>
    </div>
    <button onclick="addNewAdmin()">Add Admin</button>
    <button style="margin-top:10px; background:red; color:#fff; width:100%;" onclick="closeAdminPopup()">Close</button>
  </div>
</div>

<!-- ================== HEADER with Menu & Profile ================== -->
<div class="header">
  <!-- Menu Dropdown -->
  <div class="menu-container">
    <div class="menu-icon" title="Menu" style="cursor:pointer; font-size:24px;" onclick="toggleMenuDropdown()">â˜°</div>
    <div id="menuDropdown">
      <button onclick="showSection('dashboard')">Dashboard</button>
      <button onclick="window.location.href='http://127.0.0.1:5501/driver-app/admin/estabilshment.html '">Establishment</button>
      <button onclick="window.location.href='http://127.0.0.1:5501/driver-app/admin/restaurant_menu.html '">Restaurant Menu</button>
      <button onclick="showSection('Driver')">Driver</button>
      <button onclick="showSection('Vendor')">Vendor</button>
    </div>
  </div>
  <!-- Profile Section -->
  <div class="profile-section" style="display:flex; align-items:center; cursor:pointer;" onclick="triggerProfileImageUpload()">
    <img src="https://via.placeholder.com/40" id="profileImage" alt="Profile" />
    <input type="file" id="profileImageInput" accept="image/*" style="display:none;" onchange="updateProfileImage(event)">
    <div class="admin-name" id="adminName">Admin</div>
  </div>
</div>

<!-- ================== DASHBOARD ================== -->
<div id="dashboard" class="section active">
  <!-- Dashboard content -->
  <!-- Your existing dashboard code for summary, charts, etc. -->
  <!-- Insert the dashboard details from your previous code here: -->
  <!-- For brevity, I'll just include the main dashboard info below -->
  <!-- The dashboard code begins: -->
  <div>
    <div class="top-bar" style="margin-top:0;">
      <div class="profile-section">
        <div class="profile-picture"></div>
        <div class="admin-name">Admin Dashboard</div>
      </div>
      <div class="menu-icon" title="Menu">â˜°</div>
    </div>
    <div class="dashboard-container">
      <!-- Filters & Income -->
      <div style="display:flex; justify-content:space-between; align-items:center; padding:10px 20px 0 20px;">
        <div style="position:relative;">
          <button onclick="toggleFilterDropdown()">Filter Establishments â–¼</button>
          <div id="filterDropdown">
            <button onclick="filterEstablishments('All')">All</button>
            <button onclick="filterEstablishments('Type 1')">Type 1</button>
            <button onclick="filterEstablishments('Type 2')">Type 2</button>
          </div>
        </div>
        <div style="display:flex; gap:10px;">
          <button style="background-color:red; color:#fff;">Total Income</button>
          <button style="background-color:red; color:#fff;">Income</button>
          <button style="background-color:red; color:#fff;">Expense</button>
          <button style="background-color:red; color:#fff;">Withdraw</button>
        </div>
      </div>
      <!-- Total Income and Amounts for Income, Expense, Withdraw with % -->
      <div style="margin-top:20px; padding-left:20px;">
        <h2>Total Income: <span id="incomeAmount">R10,000</span>
          <span class="percentage-change" id="incomePerc"></span>
        </h2>
        <h2>Expense: <span id="expenseAmount">R5,000</span>
          <span class="percentage-change" id="expensePerc"></span>
        </h2>
        <h2>Withdraw: <span id="withdrawAmount">R2,000</span>
          <span class="percentage-change" id="withdrawPerc"></span>
        </h2>
      </div>
      
      <!-- Performance Section -->
      <div class="performance-section" style="margin-top:20px; padding:0 20px;">
        <div class="performance-header" style="display:flex; justify-content:space-between; align-items:center;">
          <div style="display:flex; align-items:center; gap:10px;">
            <div class="performance-title" style="font-size:20px;font-weight:bold;">Performance</div>
            <div class="performance-icon" title="Performance" style="font-size:24px;">ðŸ“ˆ</div>
          </div>
          <div style="margin-top:10px; font-size:24px;">ðŸ“ˆ</div>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center; margin-top:20px;">
          <div style="position: relative; width: 150px; height: 150px;">
            <svg viewBox="0 0 100 100" width="150" height="150" style="transform: rotate(-90deg);">
              <circle cx="50" cy="50" r="45" stroke="#eee" stroke-width="10" fill="none"/>
              <circle cx="50" cy="50" r="45" stroke="yellow" stroke-width="10"
                stroke-linecap="round"
                stroke-dasharray="282.6" stroke-dashoffset="84.78" fill="none"/>
            </svg>
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:24px; font-weight:bold;">70%</div>
          </div>
          <!-- Year Dropdown -->
          <div class="year-dropdown" style="position:relative;">
            <button class="year-button" onclick="toggleYearDropdown()">January â–¼</button>
            <div class="year-options" id="yearOptions" style="display:none; position:absolute; top:100%; right:0; background:#fff; border:1px solid #ccc; flex-direction:column; z-index:10;">
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('January')">January</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('February')">February</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('March')">March</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('April')">April</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('May')">May</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('June')">June</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('July')">July</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('August')">August</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('September')">September</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('October')">October</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('November')">November</div>
              <div style="padding:8px; cursor:pointer;" onclick="selectMonth('December')">December</div>
            </div>
          </div>
        </div>
        <!-- Order Total & Target Boxes -->
        <div class="boxes-container" style="display:flex; gap:20px; margin-top:20px;">
          <!-- Order Total -->
          <div class="box" style="background:#fff; padding:15px; flex:1; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
            <div class="box-header" style="display:flex; align-items:center; margin-bottom:10px;">
              <div class="profile-icon" style="width:30px; height:30px; border-radius:50%; background:#ccc; margin-right:10px;"></div>
              <div class="box-title" style="font-weight:bold;">Order Total</div>
            </div>
            <div class="box-amount" style="font-size:20px;">R5000</div>
          </div>
          <!-- Target -->
          <div class="box" style="background:#fff; padding:15px; flex:1; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
            <div class="box-header" style="display:flex; align-items:center; margin-bottom:10px;">
              <div class="profile-icon" style="width:30px; height:30px; border-radius:50%; background:#ccc; margin-right:10px;"></div>
              <div class="box-title" style="font-weight:bold;">Target</div>
            </div>
            <div class="target-container" style="margin-top:10px;">
              <div class="linear-bar" style="height:10px; background:#ddd; border-radius:5px; overflow:hidden;">
                <div class="target-progress" style="width:75%; height:10px; background:#4caf50;"></div>
              </div>
              <div style="margin-top:10px;">Target: 75%</div>
            </div>
          </div>
        </div>
        <!-- Last Month & Last Year -->
        <div class="selection-row" style="display:flex; gap:20px; margin-top:20px;">
          <!-- One This Month -->
          <div class="select-box" style="flex:1;">
            <div class="select-header" style="display:flex; justify-content:space-between; align-items:center;">
              <h4>One This Month</h4>
              <div class="option-icon" title="Options" style="width:30px; height:30px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;">â‹®</div>
            </div>
            <div>Number: 80</div>
            <div class="wave-graph" style="height:50px; background:#e0e0e0; margin-top:10px; border-radius:4px; display:flex; align-items:center; justify-content:center;">Wave Graph</div>
            <canvas id="waveGraphThisMonth" width="400" height="200"></canvas>
          </div>
          <!-- Last Year -->
          <div class="select-box" style="flex:1;">
            <div class="select-header" style="display:flex; justify-content:space-between; align-items: center;">
              <h4>One Last</h4>
              <div class="option-icon" title="Options" style="width:30px; height:30px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;">â‹®</div>
            </div>
            <div>Number: 70</div>
            <div class="wave-graph" style="height:50px; background:#e0e0e0; margin-top:10px; border-radius:4px; display:flex; align-items:center; justify-content:center;">Wave Graph</div>
            <canvas id="waveGraphLastYear" width="400" height="200"></canvas>
          </div>
        </div>
        <!-- Additional info rows -->
        <div style="margin-top:30px; display:flex; flex-direction:column; gap:15px; padding:0 20px;">
          <!-- Total orders complete -->
          <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-size:24px;">
              <img src="Screenshot (262).png" alt="Image" style="width:100px; height:auto; margin-bottom:20px;"/>
            </div>
            <div style="font-weight:bold;">Total orders complete</div>
            <div style="margin-left:auto;">2687</div>
          </div>
          <!-- Total orders delivered -->
          <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-size:24px;">
              <img src="Screenshot (262).png" alt="Image" style="width:100px; height:auto; margin-bottom:20px;"/>
            </div>
            <div style="font-weight:bold;">Total orders delivered</div>
            <div style="margin-left:auto;">1784</div>
          </div>
          <!-- Total orders canceled -->
          <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-size:24px;">
              <img src="Screenshot (261).png" alt="Image" style="width:100px; height:auto; margin-bottom:20px;"/>
            </div>
            <div style="font-weight:bold;">Total orders canceled</div>
            <div style="margin-left:auto;">86</div>
          </div>
          <!-- Orders pending -->
          <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-size:24px;">
              <img src="Screenshot (260).png" alt="Image" style="width:100px; height:auto; margin-bottom:20px;"/>
            </div>
            <div style="font-weight:bold;">Orders pending</div>
            <div style="margin-left:auto;">467</div>
          </div>
        </div>
        <!-- Popular Food Chart -->
  <div class="popular-food" style="margin-top:30px;">
    <div class="food-header" style="font-size:20px; font-weight:bold; margin-bottom:5px;">Popular Food</div>
    <div class="chart-container">
      <canvas id="circleChart" width="400" height="400"></canvas>
    </div>
    <div class="food-types" style="display:flex; flex-wrap:wrap; gap:15px; margin-top:10px">
      <div class="food-item" style="display:flex; align-items:center; gap:10px;">
        <div class="food-color" style="width:20px; height:20px; border-radius:50%; background:#FF6384;"></div>
        <div>Fast Food - 40%</div>
      </div>
      <div class="food-item" style="display:flex; align-items:center; gap:10px;">
        <div class="food-color" style="width:20px; height:20px; border-radius:50%; background:#36A2EB;"></div>
        <div>Asian - 20%</div>
      </div>
      <div class="food-item" style="display:flex; align-items:center; gap:10px;">
        <div class="food-color" style="width:20px; height:20px; border-radius:50%; background:#FFCE56;"></div>
        <div>Pasta - 15%</div>
      </div>
      <div class="food-item" style="display:flex; align-items:center; gap:10px;">
        <div class="food-color" style="width:20px; height:20px; border-radius:50%; background:#4BC0C0;"></div>
        <div>Mexican - 10%</div>
      </div>
      <div class="food-item" style="display:flex; align-items:center; gap:10px;">
        <div class="food-color" style="width:20px; height:20px; border-radius:50%; background:#9966FF;"></div>
        <div>Turkish - 5%</div>
      </div>
      <div class="food-item" style="display:flex; align-items:center; gap:10px;">
        <div class="food-color" style="width:20px; height:20px; border-radius:50%; background:#FF9F40;"></div>
        <div>Desserts - 10%</div>
      </div>
    </div>
  </div>
        </div>
        <!-- View Select Role Button -->
        <div style="margin:30px 20px;">
          <button style="background:red; color:#fff; padding:10px 20px; border:none; border-radius:6px; cursor:pointer;" onclick="showRolePopup()">View Select Role</button>
        </div>
        <!-- Role Management Popup -->
        <div id="rolePopup" class="modal" style="display:none; flex-direction:column;">
          <div class="modal-box" style="width:90%; max-height:90%; overflow-y:auto;">
            <h3>Role Management</h3>
            <!-- User, Vendor, Driver Tables -->
            <h4>User Accounts</h4>
            <table border="1" cellpadding="5" style="width:100%; border-collapse:collapse;">
              <thead><tr><th>Email</th><th>Actions</th></tr></thead>
              <tbody>
                <tr>
                  <td>user1@gmail.com</td>
                  <td class="role-buttons">
                    <button onclick="viewRoleInfo('User', 'user1@example.com')">View</button>
                    <button onclick="deleteRole('User', 'user1@example.com')">Delete</button>
                  </td>
                </tr>
                <tr>
                  <td>user2@gmail.com</td>
                  <td class="role-buttons">
                    <button onclick="viewRoleInfo('User', 'user2@example.com')">View</button>
                    <button onclick="deleteRole('User', 'user2@example.com')">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <h4>Vendor Accounts</h4>
            <table border="1" cellpadding="5" style="width:100%; border-collapse:collapse;">
              <thead><tr><th>Email</th><th>Actions</th></tr></thead>
              <tbody>
                <tr>
                  <td>vendor1@gmail.com</td>
                  <td class="role-buttons">
                    <button onclick="viewRoleInfo('Vendor', 'vendor1@example.com')">View</button>
                    <button onclick="deleteRole('Vendor', 'vendor1@example.com')">Delete</button>
                  </td>
                </tr>
                <tr>
                  <td>vendor2@gmail.com</td>
                  <td class="role-buttons">
                    <button onclick="viewRoleInfo('Vendor', 'vendor2@example.com')">View</button>
                    <button onclick="deleteRole('Vendor', 'vendor2@example.com')">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <h4>Driver Accounts</h4>
            <table border="1" cellpadding="5" style="width:100%; border-collapse:collapse;">
              <thead><tr><th>Email</th><th>Actions</th></tr></thead>
              <tbody>
                <tr>
                  <td>driver1@gmail.com</td>
                  <td class="role-buttons">
                    <button onclick="viewRoleInfo('Driver', 'driver1@example.com')">View</button>
                    <button onclick="deleteRole('Driver', 'driver1@example.com')">Delete</button>
                  </td>
                </tr>
                <tr>
                  <td>driver2@gmail.com</td>
                  <td class="role-buttons">
                    <button onclick="viewRoleInfo('Driver', 'driver2@example.com')">View</button>
                    <button onclick="deleteRole('Driver', 'driver2@example.com')">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button style="margin-top:15px; background:red; color:#fff; width:100%; padding:10px; border:none; border-radius:6px;" onclick="closeRolePopup()">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ================== Driver Section ================== -->
<div id="Driver" class="section" style="display:none; padding-top:70px;">
  <h2 style="margin-left:20px;">Driver Info & Orders</h2>
  <div style="padding:20px;">
    <!-- Driver 1 -->
    <div class="driver-profile" style="display:flex; margin-bottom:20px;">
      <img src="https://via.placeholder.com/80" class="driver-img" alt="Driver" />
      <div class="driver-info" style="margin-left:10px;">
        <h4>John Doe</h4>
        <div class="driver-details">
          <p>Contact: 123-456-7890</p>
          <p>Plate: ABC-1234</p>
          <p>Email: john@gmail.com</p>
          <p>Ratings: 4.5 &#9733;</p>
          <p>Comments: Very punctual.</p>
        </div>
        <button class="hyperlink-red" onclick="showPastDeliveries('John Doe')">Past Deliveries</button>
        <button class="hyperlink-red" onclick="showDocuments('John Doe')">View Documents</button>
      </div>
    </div>
    <!-- Driver 2 -->
    <div class="driver-profile" style="display:flex; margin-bottom:20px;">
      <img src="https://via.placeholder.com/80" class="driver-img" alt="Driver" />
      <div class="driver-info" style="margin-left:10px;">
        <h4>Jane Smith</h4>
        <div class="driver-details">
          <p>Contact: 987-654-3210</p>
          <p>Plate: XYZ-5678</p>
          <p>Email: jane@gmail.com</p>
          <p>Ratings: 4.8 &#9733;</p>
          <p>Comments: Great driver.</p>
        </div>
        <button class="hyperlink-red" onclick="showPastDeliveries('Jane Smith')">Past Deliveries</button>
        <button class="hyperlink-red" onclick="showDocuments('Jane Smith')">View Documents</button>
      </div>
    </div>
  </div>
</div>

<!-- ================== Vendor Section ================== -->
<div id="Vendor" class="section" style="display:none; padding-top:70px;">
  <h2 style="margin-left:20px;">Vendor Management</h2>
  <div style="padding:20px;">
    <button onclick="showVendors()">Show All Vendors</button>
  </div>
</div>

<!-- ================== Role Info Popup ================== -->
<div id="roleInfoPopup" class="modal" style="display:none;">
  <div class="modal-box" style="width:90%; max-height:90%; overflow-y:auto;">
    <h3>Role Information</h3>
    <div id="roleInfoContent" style="margin-bottom:20px;"> <!-- Role details inserted here --> </div>
    <button style="margin-top:10px; background:rgb(255, 0, 0); color:#fff; width:100%; padding:10px; border:none; border-radius:6px;" onclick="sendNotification()">Send Email/Notification</button>
    <button style="margin-top:10px; background:red; color:#fff; width:100%; padding:10px; border:none; border-radius:6px;" onclick="closeRoleInfo()">Close</button>
  </div>
</div>

<!-- ================== Scripts ================== -->
<script src="supabaseClient.js" async></script> 
<script>
  // ================== INITIAL VARIABLES ==================
  let adminUsername = 'crunchtimeadmin';
  let adminPassword = 'crunchtimeadmin';

  let isAuthenticated = false;

// Function to show notification message in the UI
function showNotificationMessage(message, color='#4CAF50') {
  const notif = document.getElementById('notification');
  if (!notif) {
    // Create notification container if it doesn't exist
    const container = document.createElement('div');
    container.id = 'notification';
    container.style.position = 'fixed';
    container.style.bottom = '20px';
    container.style.left = '50%';
    container.style.transform = 'translateX(-50%)';
    container.style.padding = '10px 20px';
    container.style.borderRadius = '4px';
    container.style.backgroundColor = color;
    container.style.color = '#fff';
    container.style.fontSize = '14px';
    container.style.zIndex = '9999';
    document.body.appendChild(container);
    notif = container;
  } else {
    // Update existing notification
    notif.innerHTML = `<div style="background-color:${color}; color:#fff; padding:10px; display:inline-block; border-radius:4px;">${message}</div>`;
    notif.style.display = 'block';
  }

  // Auto-hide after 3 seconds
  setTimeout(() => {
    notif.style.display = 'none';
  }, 3000);
}

// Function to send SMS notification via backend API
function sendTwilioNotification(to, message) {
  showNotificationMessage('Sending notification...');
  fetch('/notify/sms', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ to: to, message: message })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      showNotificationMessage('Notification sent successfully!', '#4CAF50');
    } else {
      showNotificationMessage('Failed to send notification.', '#f44336');
    }
  })
  .catch(() => {
    showNotificationMessage('Error sending notification.', '#f44336');
  });
}

// Assuming you have an API endpoint at /notify/sms
function sendSms(to, message) {
  fetch('/notify/sms', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ to, message })
  })
  .then(res => res.json())
  .then(data => {
    console.log('SMS sent:', data);
  })
  .catch(err => {
    console.error('Error sending SMS:', err);
  });
}

  // ================== LOGIN & AUTH ==================
  function verifyLogin() {
    const u = document.getElementById('username').value.trim();
    const p = document.getElementById('password').value.trim();
    if (u===adminUsername && p===adminPassword) {
      alert('Login successful!');
      document.getElementById('loginModal').style.display='none';
      isAuthenticated = true;
      showAdminPopup(); // Show admin update popup after login
    } else {
      alert('Invalid credentials.');
    }
  }

  // Show section
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById(id).style.display='block';

    // Load driver/vendor info if needed
    if (id === 'Vendor') loadVendors();
    if (id === 'Driver') loadDrivers();
  }

  // ================== Menu & Profile ==================
  function toggleMenuDropdown() {
    const dd = document.getElementById('menuDropdown');
    dd.style.display = (dd.style.display==='block') ? 'none' : 'block';
  }
  document.addEventListener('click', e => {
    if (!e.target.closest('.menu-container')) {
      document.getElementById('menuDropdown').style.display='none';
    }
  });

  function triggerProfileImageUpload() { document.getElementById('profileImageInput').click(); }
  function updateProfileImage(e) {
    const file = e.target.files[0];
    if (file) {
      const reader=new FileReader();
      reader.onload=function(ev) { document.getElementById('profileImage').src=ev.target.result; }
      reader.readAsDataURL(file);
    }
  }

  // ================== Admin Credential Functions ==================
  function showAdminPopup() { document.getElementById('adminPopup').style.display='flex'; }
  function closeAdminPopup() { document.getElementById('adminPopup').style.display='none'; }
  function saveAdminCredentials() {
    const newU = document.getElementById('newUsername').value.trim();
    const newP = document.getElementById('newPassword').value.trim();
    if (newU && newP) {
      adminUsername = newU;
      adminPassword = newP;
      sendEmail('crunchtimedrivein@gmail.com', 'Updated Admin Login', `New Admin Credentials:\nUsername: ${adminUsername}\nPassword: ${adminPassword}`);
      alert('Credentials updated and email sent.');
      document.getElementById('adminName').innerText=adminUsername;
    } else {
      alert('Please provide new credentials.');
    }
    closeAdminPopup();
  }

  // ================== Add New Admin ==================
  function addNewAdmin() {
    const email = document.getElementById('newAdminEmail').value.trim();
    const username = document.getElementById('newAdminUsername').value.trim();
    const password = document.getElementById('newAdminPassword').value.trim();
    if (email && username && password) {
      const recordText = `Admin Email: ${email}\nUsername: ${username}\nPassword: ${password}\n---\n`;
      sendEmail('crunchtimedrivein@gmail.com', 'New Admin Record', recordText);
      alert('New admin added and record sent.');
      document.getElementById('newAdminEmail').value='';
      document.getElementById('newAdminUsername').value='';
      document.getElementById('newAdminPassword').value='';
    } else {
      alert('Please fill all fields for new admin.');
    }
  }

  // ================== Filter & Dropdowns ==================
  function toggleFilterDropdown() {
    const el = document.getElementById('filterDropdown');
    el.style.display = (el.style.display==='block') ? 'none' : 'block';
  }
  function filterEstablishments(type) {
    alert('Filtering by: ' + type);
    document.getElementById('filterDropdown').style.display='none';
  }

  function toggleYearDropdown() {
    const el = document.getElementById('yearOptions');
    el.style.display = (el.style.display==='none' || el.style.display==='') ? 'block' : 'none';
  }
  function selectMonth(month) {
    document.querySelector('.year-button').innerText=month + ' â–¼';
    document.getElementById('yearOptions').style.display='none';
    updateMonthlyData(month);
  }

  // ================== Chart Initialization ==================
  function initCharts() {
    // Wave Graphs
    const ctxWaveThisMonth = document.getElementById('waveGraphThisMonth').getContext('2d');
    new Chart(ctxWaveThisMonth, {
      type:'line',
      data:{
        labels:['JAN','FEB','MAR','APR ','MAY ','JUN ','JUL ','AUG ','SEP ','OCT ','NOV ','DEC '],
        datasets:[
          {
            label:'This Month Data',
            data:[20,10,30,50,40,60,70,100,40,90],
            backgroundColor:'rgba(255,159,64,0.2)',
            borderColor:'rgba(255,159,64,1)',
            borderWidth:2,
            tension:0.4,
            fill:true,
          },
          {
            label:'Tracking Sales',
            data:[25,15,35,55,45,65,75,110,50,100],
            backgroundColor:'rgba(75,192,192,0.2)',
            borderColor:'rgba(75,192,192,1)',
            borderWidth:2,
            tension:0.4,
            fill:true,
          },
          {
            label:'Menu Items',
            data:[30,20,40,60,50,70,80,120,60,110],
            backgroundColor:'rgba(153,102,255,0.2)',
            borderColor:'rgba(153,102,255,1)',
            borderWidth:2,
            tension:0.4,
            fill:true,
          }
        ]
      },
      options:{ responsive:true, plugins:{ legend:{ display:true } } }
    });
    // Last Year Wave Graph
    const ctxWaveLastYear = document.getElementById('waveGraphLastYear').getContext('2d');
    new Chart(ctxWaveLastYear, {
      type:'line',
      data:{
        labels:['JAN','FEB','MAR','APR ','MAY ','JUN ','JUL ','AUG ','SEP ','OCT ','NOV ','DEC '],
        datasets:[
          {
            label:'Last Year Data',
            data:[20,10,30,50,40,60,70,100,20,50],
            backgroundColor:'rgba(153,102,255,0.2)',
            borderColor:'rgba(153,102,255,1)',
            borderWidth:2,
            tension:0.4,
            fill:true,
          },
          {
            label:'Tracking Sales',
            data:[22,12,32,52,42,62,72,102,22,52],
            backgroundColor:'rgba(255,99,132,0.2)',
            borderColor:'rgba(255,99,132,1)',
            borderWidth:2,
            tension:0.4,
            fill:true,
          },
          {
            label:'Menu Items',
            data:[28,18,38,58,48,68,78,118,28,58],
            backgroundColor:'rgba(54,162,235,0.2)',
            borderColor:'rgba(54,162,235,1)',
            borderWidth:2,
            tension:0.4,
            fill:true,
          }
        ]
      },
      options:{ responsive:true, plugins:{ legend:{ display:true } } }
    });
    // Draw circle graph
    drawCircleGraph();
  }

  function drawCircleGraph() {
    const ctx = document.getElementById('circleChart').getContext('2d');
    new Chart(ctx, {
      type:'doughnut',
      data:{
        labels:['Fast Food','Asian','Pasta','Mexican','Turkish','Desserts'],
        datasets:[{
          label:'Food Types',
          data:[40,20,15,10,5,10],
          backgroundColor:['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40'],
          hoverOffset:4
        }]
      },
      options:{
        responsive:true,
        plugins:{ legend:{ position:'bottom' } }
      }
    });
  }

  // ================== Role Popup Functions ==================
  function showRolePopup() {
    document.getElementById('rolePopup').style.display='flex';
  }
  function closeRolePopup() {
    document.getElementById('rolePopup').style.display='none';
  }
  let currentRoleEmail='';
  let currentRoleType='';
  function viewRoleInfo(roleType, email) {
    document.getElementById('roleInfoContent').innerHTML= `
      <h4>${roleType} Role Details</h4>
      <p>Email: ${email}</p>
      <p>Role: ${roleType}</p>
      <p>Status: Active</p>
    `;
    window.currentRoleEmail=email;
    window.currentRoleType=roleType;
    showRoleInfo();
  }
  function deleteRole(roleType, email) {
    alert(`Are you sure you want to delete ${roleType} account: ${email}?`);
  }
  function showRoleInfo() {
    document.getElementById('roleInfoPopup').style.display='flex';
  }
  function closeRoleInfo() {
    document.getElementById('roleInfoPopup').style.display='none';
  }
  function sendNotification() {
    if (window.currentRoleEmail) {
      sendEmail(window.currentRoleEmail, 'Notification from Admin', 'You have a new notification from admin.');
    }
  }

  // ================== Driver & Vendor Functions ==================
  function showVendors() { alert('Display all vendors with accept/reject options and history.'); }
  function showPastDeliveries(driverName) { alert('Showing past deliveries for ' + driverName); }
  function showDocuments(driverName) { alert('Showing documents for ' + driverName); }

  // Load driver data (simulate)
  async function loadDrivers() {
    // Example: set static data for demo
    document.querySelectorAll('.driver-profile').forEach((div, index) => {
      if (index === 0) {
        div.querySelector('h4').innerText='John Doe';
        div.querySelectorAll('p')[0].innerText='Contact: 123-456-7890';
        div.querySelectorAll('p')[1].innerText='Plate: ABC-1234';
        div.querySelectorAll('p')[2].innerText='Email: john@gmail.com';
        div.querySelectorAll('p')[3].innerHTML='Ratings: 4.5 &#9733;';
        div.querySelectorAll('p')[4].innerText='Comments: Very punctual.';
      } else if (index===1) {
        div.querySelector('h4').innerText='Jane Smith';
        div.querySelectorAll('p')[0].innerText='Contact: 987-654-3210';
        div.querySelectorAll('p')[1].innerText='Plate: XYZ-5678';
        div.querySelectorAll('p')[2].innerText='Email: jane@gmail.com';
        div.querySelectorAll('p')[3].innerHTML='Ratings: 4.8 &#9733;';
        div.querySelectorAll('p')[4].innerText='Comments: Great driver.';
      }
    });
  }

  // Load vendor data (simulate)
  async function loadVendors() {
    // For demo, static data or fetch from your backend
  }

  // Show all vendors (demo)
  function showVendors() { alert('Display all vendors with accept/reject options and history.'); }

  // When page loads
  window.onload = () => {
    if (!isAuthenticated) {
      document.getElementById('loginModal').style.display='flex';
    } else {
      document.getElementById('loginModal').style.display='none';
    }
    initCharts();
    updateMonthlyData('January');
    loadDrivers();
    loadVendors();
  };
</script>
<!-- Import your supabase client setup (from your code) -->
<script src="supabaseClient.js" async></script>
<script src="payfast-track.js" async></script>

</body>
</html>