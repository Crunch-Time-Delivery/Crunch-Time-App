<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>User Home Dashboard</title>
<!-- Your bundled CSS (if using a build tool) -->
<link rel="stylesheet" href="assets/index.css" />
<!-- QRCode & sha256 libraries -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-sha256/dist/sha256.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
/* --- Combined Styles --- */
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background-color: #f9f9f9;
}
#root { display: none; }
/* Header styles */
.header {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: #fff;
  border-bottom: 1px solid #ddd;
}
.header button {
  background: none;
  border: none;
  font-size: 16px;
  cursor: pointer;
  padding: 5px 10px;
}
.search-bar {
  flex: 1;
  min-width: 200px;
  margin: 10px;
}
.search-bar input {
  width: 100%;
  padding: 5px;
  border: 1px solid #ddd;
  border-radius: 5px;
}
/* Filters styles */
.filters {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  padding: 10px 20px;
  background: #ffb4b4;
  border-bottom: 1px solid #ddd;
}
.filters button {
  background: none;
  border: none;
  cursor: pointer;
  margin: 5px;
  padding: 5px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.filters button img {
  width: 24px;
  height: 24px;
  margin-bottom: 5px;
  object-fit: cover;
  border-radius: 4px;
}
/* Restaurant cards */
.restaurant-list {
  padding: 10px 20px;
  max-height: 70vh;
  overflow-y: auto;
}
.restaurant-card {
  display: flex;
  background: #fff;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  cursor: pointer;
  position: relative;
  align-items: center;
}
.restaurant-card img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  margin-right: 10px;
}
.restaurant-card .details {
  flex: 1;
}
.restaurant-card .rating { color: #666; font-weight: bold; }
.restaurant-card .promo { color: red; font-weight: bold; }
.fav {
  position: absolute; top: 10px; right: 10px; font-size: 20px; background:none; border:none; cursor:pointer;
}
/* Modal overlay styles */
.modal {
  display: none; position: fixed; z-index: 999; left:0; top:0; width:100%; height:100%;
  background: rgba(0,0,0,0.5);
}
.modal-content {
  background:#fff; margin:50px auto; padding:20px; border-radius:10px; max-width:600px; position:relative;
}
.close-btn {
  position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; font-weight:bold;
}
#restaurantImage {
  width:100%; max-height:200px; object-fit:cover; border-radius:5px; margin-bottom:10px; cursor:pointer;
}
/* Specific modal sizes for opinion & food detail modals */
#foodOpinionModal, #restaurantMenuModal, #foodDetailModal {
  max-width:400px;
}
/* Order & Receipt styles */
#orderSummary {
  padding: 10px 20px;
  background: #fff;
  max-height: 200px;
  overflow-y: auto;
  margin: 10px;
  border-radius: 4px;
}
#orderItems {
  list-style: none;
  padding: 0;
}
#orderItems li {
  margin-bottom: 8px;
}
#checkoutPage {
  display: none;
  padding: 20px;
  background: #fff;
  max-width: 600px;
  margin: auto;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  margin-top: 20px;
}
#checkoutPage h2, #checkoutPage h3 {
  margin-top: 0;
}
#checkoutItems {
  list-style: none;
  padding: 0;
  margin: 10px 0;
}
#checkoutItems li {
  margin-bottom: 8px;
}
/* Buttons styling */
button {
  padding:10px 20px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:10px;
}
#checkoutBtn {
  width:100%; padding:15px; background:#f00; color:#fff; font-size:16px; border-radius:8px; margin-top:10px;
}
#checkoutBtn:hover { background:#b00; }
.pay-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 20px;
}
.confirm-btn {
  background-color: #f90404;
  color: white;
}
.cancel-btn {
  background-color: #f40505;
  color: white;
  margin-left: 10px;
}
/* Voucher & QR code styles */
#qrCodeContainer {
  margin-top:10px; padding:10px; border:1px solid #ddd; display:inline-block; border-radius:4px;
}
/* Additional modals for order history & voucher */
#orderHistoryModal {
  display: none;
}
#orderHistoryModal .modal-content {
  max-height: 80vh;
  overflow-y: auto;
}
#orderHistoryList div {
  border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius:4px;
}
#orderHistoryBtn {
  background-color: red;
  color: white;
  padding: 10px;
  border: none;
  border-radius: 5px;
  margin-top: 10px;
  cursor: pointer;
  width: 100%;
  font-weight: bold;
}
#voucherModal {
  display: none;
}
#voucherModal .modal-content {
  max-width: 400px;
}
/* Styles for payment popup */
#paymentPopup {
  display: none; position: fixed; z-index: 1000; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center;
}
#paymentPopup .popup-content {
  background:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%;
}
#paymentPopup h3 {
  margin-top: 0;
  text-align: center;
}
.payment-options {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-top: 15px;
}
.payment-option {
  display: flex;
  align-items: center;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
}
.payment-option:hover {
  background-color: #f0f0f0;
}
.payment-icons {
  display: flex;
  gap: 10px;
}
.payment-icons img {
  width: 50px;
  height: auto;
}
#eftDetails {
  margin-top: 15px;
  padding: 10px;
  border: 1px dashed #aaa;
  border-radius: 8px;
  background: #f9f9f9;
  font-family: monospace;
  font-size: 14px;
}
.popup-buttons {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
}
.popup-buttons button {
  padding: 10px 20px;
}
/* Bank Details Input Popup */
#bankDetailsInput {
  display: none; position: fixed; z-index: 1001; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center;
}
#bankDetailsInput .popup-content {
  background:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%;
}
/* Add Red Button at Checkout */
#payNowButton {
  background-color: red; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <button>&#9776;</button>
  <div>Crunch Time</div>
  <button>Delivery</button>
  <button>Pickup</button>
  <div class="search-bar">
    <input type="text" placeholder="Search Crunch Time" />
  </div>
  <button onclick="openMapLocation()">Map Location - Pick up now</button>
</div>

<!-- Filters -->
<div class="filters">
  <button><img src="Images/Ultraprocessed foods display 2 framed - shutterstock_2137640529_r.jpg" alt="Fast Food" /><span>Fast Food</span></button>
  <button><img src="Images/CR7 Veg .jpg" alt="Healthy" /><span>Healthy</span></button>
  <button><img src="Images/CR7.jpg" alt="Burgers" /><span>Burgers</span></button>
  <button><img src="Images/CR7 SUCCI.jpg" alt="Chinese" /><span>Chinese</span></button>
  <button><img src="Images/CR7 WINGS.jpg" alt="Wings" /><span>Wings</span></button>
  <button><img src="Images/CR7 PIZZA.webp" alt="Pizza" /><span>Pizza</span></button>
  <button><img src="Images/CR7 SUCCI .webp" alt="Halal" /><span>Halal</span></button>
  <button><img src="Images/CR7 KOREA .jpeg" alt="Korean" /><span>Korean</span></button>
  <button>&rarr;</button>
</div>

<!-- Restaurant list -->
<div class="restaurant-list" id="restaurantList">
  <!-- Sample restaurants -->
  <div class="restaurant-card" onclick="showMenu('KFC Parow')">
    <img src="Images/RS KFC .jpeg" alt="KFC Parow" />
    <div class="details">
      <div>KFC, Parow</div>
      <div class="rating">4.4 ★</div>
      <div>Sponsored - 5 min - 4.4 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">♥</button>
  </div>
  <div class="restaurant-card" onclick="showMenu('Sannes Palace')">
    <img src="Images/RS PALACE .jpg" alt="Sannes Palace" />
    <div class="details">
      <div>Sannes Palace</div>
      <div class="rating">4.5 ★</div>
      <div class="promo">Spend ZAR 100, Save ZAR 15</div>
      <div>20 min - 0.5 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">♥</button>
  </div>
  <div class="restaurant-card" onclick="showMenu('DK Spot & Kota')">
    <img src="Images/RS KOTA .jpg" alt="DK Spot & Kota" />
    <div class="details">
      <div>DK Spot & Kota Restaurant</div>
      <div class="rating">4.0 ★</div>
      <div>Uber Eats HDP-Owned - 16 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">♥</button>
  </div>
  <div class="restaurant-card" onclick="showMenu('Nondyebo Eatery')">
    <img src="Images/RS NONDYEBO.jpg" alt="Nondyebo Eatery" />
    <div class="details">
      <div>Nondyebo Eatery</div>
      <div class="rating">3.3 ★</div>
      <div>10 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">♥</button>
  </div>
</div>

<!-- Modal for Restaurant Menu -->
<div id="menuModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <img id="restaurantImage" src="" alt="Restaurant Image" />
    <h2 id="restaurantName">Restaurant Menu</h2>
    <div id="menuItems"></div>
    <button class="view-map-btn" onclick="viewMap()">View Map Location</button>
  </div>
</div>

<!-- Food Opinion Modal -->
<div id="foodOpinionModal" class="modal">
  <div class="modal-content" style="max-width:400px;">
    <span class="close-btn" onclick="closeFoodOpinionModal()">&times;</span>
    <h3>Tell us your preference</h3>
    <select id="opinionChoice" style="width:100%; padding:8px;">
      <option>No preference</option>
      <option>Spicy</option>
      <option>Less Salt</option>
      <option>Extra cheese</option>
      <option>No onions</option>
      <option>Less Sugar</option>
      <option>Extra Ice</option>
    </select>
    <div style="margin-top:20px; display:flex; justify-content:center;">
      <button class="add-more-btn" onclick="confirmFoodOpinion()">Next</button>
    </div>
  </div>
</div>

<!-- Food Item Modal -->
<div id="foodModal" class="food-modal">
  <div class="food-modal-content">
    <span class="food-close-btn" onclick="closeFoodModal()">&times;</span>
    <h3 id="foodItemName">Food Item</h3>
    <div style="display:flex; align-items:center; justify-content:space-around; margin-top:10px;">
      <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
      <span id="foodQuantity">1</span>
      <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
    </div>
    <div style="margin-top:20px; display:flex; justify-content:center;">
      <button class="add-more-btn" onclick="addItemToOrder()">Add to Order</button>
      <button class="exit-btn" onclick="closeFoodModal()">Exit</button>
    </div>
  </div>
</div>

<!-- Order Summary -->
<div id="orderSummary" style="padding:10px 20px; background:#fff; max-height:200px; overflow-y:auto; margin:10px;">
  <h4>Order Summary</h4>
  <ul id="orderItems"></ul>
  <!-- Buttons below order summary -->
  <button id="checkoutBtn" class="checkout-btn" onclick="goToCheckout()">Go to Checkout</button>
  <button id="orderHistoryBtn" style="background-color:red; color:#fff; padding:10px; border:none; border-radius:5px; margin-top:10px; cursor:pointer; width:100%; font-weight:bold;" onclick="showOrderHistory()">Order History</button>
  <button id="voucherBtn" style="background-color:#f80505; color:#fff; padding:10px; border:none; border-radius:5px; margin-top:10px; cursor:pointer; width:100%; font-weight:bold;" onclick="showVoucherInput()">Input Voucher Coupon</button>
  <!-- "By Go to Checkout" payment button -->
  <button id="payBtn" class="pay-btn" style="background:#007bff; margin-top:10px;" onclick="showPaymentPopup()">By Go to Checkout</button>
</div>

<!-- Checkout Page -->
<div id="checkoutPage">
  <h2>Checkout</h2>
  <h3>Order Summary</h3>
  <ul id="checkoutItems"></ul>
  <h3>Total: <span id="totalAmount">R0</span></h3>
  <!-- Red "Pay" button that triggers payment options popup -->
  <button id="payNowButton" onclick="showPaymentMethodPage()">Pay</button>
  <!-- Remove the Confirm EFT button here -->
</div>

<!-- Payment popup modal (for EFT, Card) -->
<div id="paymentPopup" class="modal">
  <div class="popup-content">
    <h3>Select Payment Method</h3>
    <div class="payment-options">
      <div class="payment-option" onclick="selectPaymentMethod('Card')">
        <div class="payment-icons">
          <img src="https://img.icons8.com/color/48/000000/visa.png" alt="Visa" />
          <img src="https://img.icons8.com/color/48/000000/mastercard-logo.png" alt="MasterCard" />
          <img src="https://img.icons8.com/color/48/000000/amex.png" alt="Amex" />
        </div>
        <span style="margin-left:10px;">Pay by Card</span>
      </div>
      <div class="payment-option" onclick="selectPaymentMethod('EFT')">
        <strong>EFT Bank Transfer</strong>
      </div>
    </div>
    <div id="eftDetails" style="display:none; margin-top:15px;">
      <h4>Banking Details</h4>
      <p>Bank: ABC Bank</p>
      <p>Account Number: 123456789</p>
      <p>Branch Code: 000123</p>
      <p>Account Name: CrunchTime</p>
      <button style="margin-top:10px; padding:8px 12px; background:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer;" onclick="openBankDetailsInput()">Enter/Edit Banking Details</button>
    </div>
    <div class="popup-buttons" style="margin-top:20px;">
      <button onclick="finalizePayment()">Pay Now</button>
      <button onclick="closePaymentPopup()">Cancel</button>
    </div>
  </div>
</div>

<!-- Remove the AI Payment System popup modal entirely -->
<!--
<div id="aiPaymentSystem" class="modal">
  <div class="popup-content" style="max-width:400px;">
    <span class="close-btn" onclick="closeAIPaymentSystem()">&times;</span>
    <h3>AI Payment System</h3>
    <p>Processing your payment securely with AI assistance...</p>
    <button style="width:100%; background:#28a745; color:#fff; padding:10px; border:none; border-radius:5px; margin-top:10px;" onclick="simulateAIPayment()">Pay Now</button>
  </div>
</div>
-->

<!-- Exception Notification -->
<div id="exceptionNotification" style="display:none; position:fixed; top:20px; right:20px; background:#f44336; color:#fff; padding:15px; border-radius:5px; z-index:2000;">
  <strong>Payment Error:</strong> There was an issue processing your payment. Please try again.
</div>

<!-- Bank Details Input Popup -->
<div id="bankDetailsInput" class="modal">
  <div class="popup-content" style="max-width:400px;">
    <span class="close-btn" onclick="closeBankDetails()">&times;</span>
    <h3>Enter Banking Details</h3>
    <form id="bankDetailsForm">
      <label>Bank Name:</label><br>
      <input type="text" id="bankName" style="width:100%; padding:8px;"><br><br>
      <label>Account Number:</label><br>
      <input type="text" id="accountNumber" style="width:100%; padding:8px;"><br><br>
      <label>Branch Code:</label><br>
      <input type="text" id="branchCode" style="width:100%; padding:8px;"><br><br>
      <label>Account Name:</label><br>
      <input type="text" id="accountName" style="width:100%; padding:8px;"><br><br>
      <button type="button" style="width:100%; background:#28a745; color:#fff; padding:10px; border:none; border-radius:5px;" onclick="saveBankDetails()">Save Details</button>
    </form>
  </div>
</div>

<script>
/* =========================
   GLOBAL VARIABLES
========================= */
let orderItems = [];
let orderHistory = [];
let discountAmount = 0;
let selectedPaymentMethod = null;
let bankDetails = {}; // Save bank details here

/* =========================
   Utility Functions
========================= */
function showModal(id) { document.getElementById(id).style.display='flex'; }
function hideModal(id) { document.getElementById(id).style.display='none'; }

// Show/Hide specific modals
window.onclick = function(e) {
  const modalIds=['menuModal','foodModal','orderHistoryModal','voucherModal','paymentPopup','bankDetailsInput'];
  modalIds.forEach(id => {
    if (e.target===document.getElementById(id)) hideModal(id);
  });
};

/* =========================
   Restaurant Menu Data & Functions
========================= */
const restaurantMenus={
  'KFC Parow':[ {name:'Zinger Burger',price:'R50'}, {name:'Fries',price:'R20'}, {name:'Cola',price:'R15'} ],
  'Sannes Palace':[ {name:'Chicken Curry',price:'R80'}, {name:'Veggie Plate',price:'R60'}, {name:'Lemonade',price:'R10'} ],
  'DK Spot & Kota':[ {name:'Kota Special',price:'R25'}, {name:'Fries',price:'R20'}, {name:'Soda',price:'R15'} ],
  'Nondyebo Eatery':[ {name:'Wrap',price:'R40'}, {name:'Salad',price:'R35'}, {name:'Juice',price:'R12'} ]
};

/* =========================
   Show/Hide Modals
========================= */
function showModal(id) { document.getElementById(id).style.display='flex'; }
function hideModal(id) { document.getElementById(id).style.display='none'; }

// Show Menu
function showMenu(restName) {
  currentRestaurant=restName;
  document.getElementById('restaurantName').innerText=restName+' Menu';
  const imgEl=document.getElementById('restaurantImage');
  switch(restName){
    case 'KFC Parow': imgEl.src='Images/RS KFC .jpeg'; break;
    case 'Sannes Palace': imgEl.src='Images/RS PALACE .jpg'; break;
    case 'DK Spot & Kota': imgEl.src='Images/RS KOTA .jpg'; break;
    case 'Nondyebo Eatery': imgEl.src='Images/RS NONDYEBO.jpg'; break;
    default: imgEl.src='';
  }
  const menuDiv=document.getElementById('menuItems');
  menuDiv.innerHTML='';
  (restaurantMenus[restName]||[]).forEach(itm => {
    const div=document.createElement('div');
    div.className='menu-item';
    div.innerHTML=`<strong>${itm.name}</strong> - ${itm.price}`;
    div.onclick=()=>{ openFoodOptionModal(itm); };
    menuDiv.appendChild(div);
  });
  showModal('menuModal');
}
function closeModal() { hideModal('menuModal'); }
function viewMap() {
  let url='';
  switch(currentRestaurant){
    case 'KFC Parow': url='https://www.google.com/maps/search/?api=1&query=KFC+Parow'; break;
    case 'Sannes Palace': url='https://www.google.com/maps/search/?api=1&query=Sannes+Palace'; break;
    case 'DK Spot & Kota': url='https://www.google.com/maps/search/?api=1&query=DK+Spot+Kota'; break;
    case 'Nondyebo Eatery': url='https://www.google.com/maps/search/?api=1&query=Nondyebo+Eatery'; break;
    default: url='https://www.google.com/maps'; break;
  }
  window.open(url,'_blank');
}
function toggleFavorite(btn) {
  if (btn.innerText==='♥') { btn.innerText='♡'; }
  else { btn.innerText='♥'; }
}

/* =========================
   Food Option Selection
========================= */
function openFoodOptionModal(itm) {
  pendingFoodItem=itm;
  currentQty=1;
  document.getElementById('opinionChoice').value='No preference';
  showModal('foodOpinionModal');
}
function closeFoodOptionModal() { hideModal('foodOpinionModal'); }
function confirmFoodOpinion() {
  const opinion=document.getElementById('opinionChoice').value;
  if(pendingFoodItem){
    orderItems.push({name:pendingFoodItem.name, price:pendingFoodItem.price, quantity:currentQty, opinion: opinion});
    updateOrderSummary();
  }
  closeFoodOptionModal();
}

/* =========================
   Food Modal for adding items
========================= */
function openFoodModal(itm) {
  pendingFoodItem = itm;
  currentQty=1;
  document.getElementById('foodItemName').innerText=itm.name;
  document.getElementById('foodQuantity').innerText=currentQty;
  showModal('foodModal');
}
function closeFoodModal() { hideModal('foodModal'); }
function changeQuantity(delta) {
  currentQty+=delta;
  if(currentQty<1) currentQty=1;
  document.getElementById('foodQuantity').innerText=currentQty;
}
function addItemToOrder() {
  if(pendingFoodItem){
    orderItems.push({name:pendingFoodItem.name, price:pendingFoodItem.price, quantity:currentQty});
    updateOrderSummary();
  }
  closeFoodModal();
}

/* =========================
   Update & Display Order
========================= */
function updateOrderSummary() {
  const ul=document.getElementById('orderItems');
  ul.innerHTML='';
  orderItems.forEach((it,idx) => {
    const li=document.createElement('li');
    li.innerHTML=`${it.name} x${it.quantity} @ ${it.price}`;
    const removeBtn=document.createElement('button');
    removeBtn.innerText='Remove';
    removeBtn.style.marginLeft='10px';
    removeBtn.onclick=()=>{ orderItems.splice(idx,1); updateOrderSummary(); };
    li.appendChild(removeBtn);
    ul.appendChild(li);
  });
}

function saveOrder() {
  if (orderItems.length>0) {
    orderHistory.push({restaurant:currentRestaurant, items:[...orderItems], date: new Date()});
  }
}

/* =========================
   Navigation & Checkout
========================= */
function goToCheckout() {
  if (orderItems.length===0) { alert("Your cart is empty!"); return; }
  saveOrder();
  let total=0;
  orderItems.forEach(i => {
    const p=parseFloat(i.price.replace('R',''));
    total+=p*i.quantity;
  });
  total-=discountAmount;
  if (total<0) total=0;
  document.getElementById('checkoutItems').innerHTML='';
  orderItems.forEach(i => {
    const li=document.createElement('li');
    li.innerHTML=`${i.name} x${i.quantity} @ ${i.price}`;
    if(i.opinion && i.opinion!=='No preference') {
      li.innerHTML+=`<br>Pref: ${i.opinion}`;
    }
    document.getElementById('checkoutItems').appendChild(li);
  });
  document.getElementById('totalAmount').innerText=`R${total.toFixed(2)}`;
  document.getElementById('checkoutPage').style.display='block';
  document.getElementById('orderSummary').style.display='none';
}

// Remove the "Confirm EFT" button from checkout page
function cancelCheckout() {
  document.getElementById('checkoutPage').style.display='none';
  document.getElementById('orderSummary').style.display='block';
}

// Show payment method selection page
function showPaymentMethodPage() {
  document.getElementById('paymentPopup').style.display='flex';
}

// Function to handle the final payment choice
function finalizePayment() {
  if (!selectedPaymentMethod) {
    alert('Please select a payment method.');
    return;
  }
  if (selectedPaymentMethod==='EFT') {
    openBankDetailsInput();
  } else if (selectedPaymentMethod==='Card') {
    // No AI option anymore
    alert('Please proceed with your card payment.');
  }
  closePaymentPopup();
}

// Show the main payment options popup
function showPaymentPopup() {
  // Validate cart
  const totalText = document.getElementById('totalAmount').innerText;
  const totalValue = parseFloat(totalText.replace('R',''));
  if (totalValue <= 0) {
    alert("Your cart is empty! Please add items before proceeding to payment.");
    return;
  }
  selectedPaymentMethod=null;
  document.getElementById('paymentPopup').style.display='flex';
  document.getElementById('eftDetails').style.display='none';
}

// Close the payment popup
function closePaymentPopup() {
  document.getElementById('paymentPopup').style.display='none';
}

// Select payment method
function selectPaymentMethod(method) {
  selectedPaymentMethod=method;
  if (method==='EFT') {
    document.getElementById('eftDetails').style.display='block';
  } else {
    document.getElementById('eftDetails').style.display='none';
  }
}

// No longer needed to show AI Payment System
// function showAIPaymentSystem() { ... }
// function closeAIPaymentSystem() { ... }
// function simulateAIPayment() { ... }

</script>
</body>
</html>