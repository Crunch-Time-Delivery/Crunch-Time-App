<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Orders</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #f0f0f0;
  }
  header {
    display: flex;
    align-items: center;
    padding: 10px;
    background-color: #fff;
  }
  header h1 {
    flex: 1;
    margin: 0;
    font-size: 20px;
    text-align: center;
  }
  .tab-container {
    display: flex;
    margin: 10px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  .tab {
    flex: 1;
    padding: 10px 0;
    text-align: center;
    cursor: pointer;
    font-weight: bold;
  }
  .in-progress {
    background-color: red;
    color: #fff;
  }
  .completed {
    background-color: yellow;
    color: #333;
  }
  .content {
    background-color: #fff;
    margin: 10px;
    border-radius: 8px;
    padding: 10px;
  }
  .cart-section {
    border-bottom: 1px solid #ccc;
    padding-bottom: 10px;
  }
  .cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .cart-title {
    font-weight: bold;
  }
  .timer {
    color: red;
  }
  .item {
    display: flex;
    align-items: center;
    margin-top: 10px;
  }
  .item img {
    width: 80px;
    height: 80px;
    border-radius: 8px;
  }
  .item-details {
    flex: 1;
    margin-left: 10px;
  }
  .item-name {
    font-weight: bold;
  }
  .item-desc {
    font-size: 12px;
    color: #555;
  }
  .price {
    margin-top: 5px;
    font-weight: bold;
  }
  .discounted-price {
    text-decoration: line-through;
    color: #888;
    margin-left: 10px;
  }
  .free-delivery {
    display: flex;
    align-items: center;
    margin-top: 5px;
  }
  .free-delivery svg {
    width: 16px;
    height: 16px;
    margin-right: 5px;
  }
  .quantity-controls {
    display: flex;
    align-items: center;
    margin-top: 10px;
  }
  .quantity-controls button {
    width: 25px;
    height: 25px;
    font-size: 20px;
    border: none;
    background-color: #ccc;
    border-radius: 4px;
    cursor: pointer;
  }
  .quantity {
    margin: 0 10px;
    font-weight: bold;
  }
  .order-summary {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }
  .total {
    font-weight: bold;
  }
  .checkout-btn {
    display: block;
    width: 100%;
    background-color: #e53935;
    color: #fff;
    border: none;
    padding: 15px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
  }
  .orders-list {
    margin: 10px;
  }
  .order {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  .order img {
    width: 50px;
    height: 50px;
    border-radius: 8px;
  }
  .order-info {
    margin-left: 10px;
  }
  .order-title {
    font-weight: bold;
  }
  .order-subtitle, .order-price, .order-date {
    font-size: 12px;
    color: #555;
  }
</style>
</head>
<body>

<header>
<button onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'">&larr;</button>
  <h1>My Orders</h1>
</header>

<div class="tab-container">
  <div class="tab in-progress" onclick="setTab('inProgress')">In Progress</div>
  <div class="tab completed" onclick="setTab('completed')">Completed</div>
</div>

<div id="inProgress" class="content" style="display:block;">
  <div class="cart-section">
    <div class="cart-header">
      <div class="cart-title">My Cart</div>
      <div class="timer">35 min</div>
    </div>
    <div class="item">
      <img src="Images/RS KOTA .jpg" alt="DK Spot & Kota"/>
      <div class="item-details">
        <div class="item-name">Sandwich Tatuni</div>
        <div class="item-desc">Sandwich</div>
        <div class="price">R18.50 <span class="discounted-price">R22.50</span></div>
        <div class="free-delivery">
          <!-- Placeholder for icon -->
          <svg viewBox="0 0 24 24" fill="orange" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" />
          </svg>
          <span>Free delivery</span>
        </div>
        <div class="quantity-controls">
          <button onclick="changeQuantity(-1)">-</button>
          <div class="quantity" id="quantity">1</div>
          <button onclick="changeQuantity(1)">+</button>
        </div>
        <div class="order-summary">
          <div>R 18.50</div>
          <!-- Add any other info if needed -->
        </div>
      </div>
    </div>
    <button class="add-more" onclick="addMoreItems()">+ add more items</button>
  </div>
  <div style="margin-top:10px; font-weight:bold; font-size:16px;">R 18.50</div>
  <button class="checkout-btn" onclick="goToCheckout()">Go to Check out</button>
</div>

<div id="completed" class="content" style="display:none;">
  <div class="orders-list">
    <div class="order">
      <img src="Images/RS KOTA .jpg" alt="DK Spot & Kota"/>
      <div class="order-info">
        <div class="order-title">DK Spot & Kota Restaurant</div>
        <div class="order-subtitle">Delivered</div>
        <div class="order-price">R76.89</div>
        <div class="order-date">05 Oct, 2021 13:45</div>
      </div>
    </div>
    <!-- Add more orders similarly -->
  </div>
</div>

<div id="notification" style="display:none; position:fixed; top:20px; width:100%; z-index:9999; text-align:center;">
  <div style="background-color:#4CAF50; color:white; padding:10px; display:inline-block; border-radius:4px;">
    Sending notification...
  </div>
</div>

<script>
function showNotificationMessage(message, color='#4CAF50') {
  const notif = document.getElementById('notification');
  notif.innerHTML = `<div style="background-color:${color}; color:#fff; padding:10px; display:inline-block; border-radius:4px;">${message}</div>`;
  notif.style.display = 'block';

  // Hide after 3 seconds
  setTimeout(() => {
    notif.style.display = 'none';
  }, 3000);
}

function sendTwilioNotification(to, message) {
  // Show sending message
  showNotificationMessage('Sending notification...');
  
  fetch('/notify/sms', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ to: to, message: message })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      showNotificationMessage('Notification sent successfully!', '#4CAF50');
    } else {
      showNotificationMessage('Failed to send notification.', '#f44336');
    }
  })
  .catch(() => {
    showNotificationMessage('Error sending notification.', '#f44336');
  });
}



// Assuming you have an API endpoint at /notify/sms
function sendSms(to, message) {
  fetch('/notify/sms', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ to, message })
  })
  .then(res => res.json())
  .then(data => {
    console.log('SMS sent:', data);
  })
  .catch(err => {
    console.error('Error sending SMS:', err);
  });
}


  function setTab(tab) {
    document.getElementById('inProgress').style.display = (tab === 'inProgress') ? 'block' : 'none';
    document.getElementById('completed').style.display = (tab === 'completed') ? 'block' : 'none';
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('in-progress', 'completed'));
    document.querySelectorAll('.tab').forEach(t => {
      if (t.innerText.includes('In Progress') && tab === 'inProgress') {
        t.classList.add('in-progress');
      } else if (t.innerText.includes('Completed') && tab === 'completed') {
        t.classList.add('completed');
      }
    });
  }

  let quantity = 1;

  function changeQuantity(delta) {
    quantity += delta;
    if (quantity < 1) quantity = 1;
    document.getElementById('quantity').innerText = quantity;
  }

  function addMoreItems() {
    alert('Add more items functionality');
  }

  function goToCheckout() {
    href='http://127.0.0.1:5501/user-app/client/public/checkout.html';
  }
</script>
<script src="server/supabase/supabaseClient.js"async></script>
</body>
</html>