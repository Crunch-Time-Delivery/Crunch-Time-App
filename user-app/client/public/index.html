<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>User Home Dashboard</title>

<!-- External CSS -->
<link rel="stylesheet" href="assets/index.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- External JS libraries -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-sha256/dist/sha256.min.js"></script>

<!-- Combined Styles -->
<style>
/* --- Merged Styles --- */
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background-color: #f9f9f9;
}
/* Common styles from both snippets, adjusted as needed */

#root { display: none; }

/* Header styles */
.header {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: #fff;
  border-bottom: 1px solid #ddd;
}
.header button {
  background: none;
  border: none;
  font-size: 16px;
  cursor: pointer;
  padding: 5px 10px;
}
.search-bar {
  flex: 1;
  min-width: 200px;
  margin: 10px;
}
.search-bar input {
  width: 100%;
  padding: 5px;
  border: 1px solid #ddd;
  border-radius: 5px;
}

/* Filters styles */
.filters {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  padding: 10px 20px;
  background: #ffb4b4;
  border-bottom: 1px solid #ddd;
}
.filters button {
  background: none;
  border: none;
  cursor: pointer;
  margin: 5px;
  padding: 5px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.filters button img {
  width: 24px;
  height: 24px;
  margin-bottom: 5px;
  object-fit: cover;
  border-radius: 4px;
}
.filters button span {
  font-size: 14px;
  font-weight: 600;
  color: #333;
}

/* Restaurant cards */
.restaurant-list {
  padding: 10px 20px;
  max-height: 70vh;
  overflow-y: auto;
}
.restaurant-card {
  display: flex;
  background: #fff;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  cursor: pointer;
  position: relative;
  align-items: center;
}
.restaurant-card img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  margin-right: 10px;
}
.restaurant-card .details {
  flex: 1;
}
.restaurant-card .rating { color: #666; font-weight: bold; }
.restaurant-card .promo { color: red; font-weight: bold; }
.fav {
  position: absolute; top: 10px; right: 10px; font-size: 20px; background:none; border:none; cursor:pointer;
}

/* Modal overlays & other styles omitted for brevity, reusing your extensive styles from second snippet */
.modal {
  display: none; position: fixed; z-index: 999; left:0; top:0; width:100%; height:100%;
  background: rgba(0,0,0,0.5);
}
.modal-content {
  background:#fff; margin:50px auto; padding:20px; border-radius:10px; max-width:600px; position:relative;
}
.close-btn {
  position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; font-weight:bold;
}
#restaurantImage {
  width:100%; max-height:200px; object-fit:cover; border-radius:5px; margin-bottom:10px; cursor:pointer;
}
/* Additional modal styles, buttons, QR code, profile modal, etc., retained from your second snippet */
#profileModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 9999;
  justify-content: center;
  align-items: center;
}
.profile-box {
  background: #fff;
  width: 380px;
  padding: 20px;
  border-radius: 10px;
}
.profile-box h3 {
  text-align: center;
  margin-top: 0;
}
.profile-box input,
.profile-box select {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
}
.profile-box button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  border-radius: 6px;
}
.save-btn { background: #f00707; color: white }
.delete-btn { background: red; color: white }
.close-btn { background: #777; color: white }
/* Additional styles for notifications, QR, payment, etc., also retained */
#notification {
  display:none; position:fixed; top:20px; width:100%; z-index:9999; text-align:center;
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <button>&#9776;</button>
  <div>Crunch Time</div>
  <button>Delivery</button>
  <button>Pickup</button>
  <div class="search-bar">
    <input type="text" placeholder="Search Crunch Time" />
  </div>
  <button onclick="window.location.href='http://127.0.0.1:5501/user-app/search_location.html'">Map Location - Pick up now</button>
  <span class="user-icon" onclick="openProfile()">ðŸ‘¤</span>
</div>

<!-- PROFILE MODAL -->
<div id="profileModal">
  <div class="profile-box">
    <h3>User Profile</h3>
    <input id="username" disabled placeholder="Username" />
    <input id="email" disabled placeholder="Email" />
    <input id="password" placeholder="Password" />

    <button class="save-btn" onclick="updatePassword()">Update Password</button>
    <hr>
    <h4>Card Details</h4>
    <select id="cardType">
      <option value="">Select Card</option>
      <option>Visa</option>
      <option>MasterCard</option>
      <option>Amex</option>
    </select>
    <input id="cardNumber" placeholder="Card Number" />
    <input id="cvv" placeholder="CVV" />
    <input id="securityCode" placeholder="Security Code" />
    <button class="save-btn" onclick="saveCardDetails()">Save Card</button>
    <button class="delete-btn" onclick="deleteUser()">Delete Account</button>
    <button class="close-btn" onclick="closeProfile()">Close</button>
  </div>
</div>

<!-- FILTER BUTTONS -->
<div class="filters">
  <button class="filter-btn" onclick="selectCategory('Fast Food')">
    <img src="Images/Ultraprocessed foods display 2 framed - shutterstock_2137640529_r.jpg" alt="Fast Food" />
    <span>Fast Food</span>
  </button>
  <button class="filter-btn" onclick="selectCategory('Burgers')">
    <img src="Images/CR7.jpg" alt="Burgers" />
    <span>Burgers</span>
  </button>
  <button class="filter-btn" onclick="selectCategory('Asian')">
    <img src="Images/CR7 SUCCI.jpg" alt="Asian" />
    <span>Asian</span>
  </button>
  <button class="filter-btn" onclick="selectCategory('Pizza')">
    <img src="Images/CR7 PIZZA.webp" alt="Pizza" />
    <span>Pizza</span>
  </button>
</div>

<!-- Restaurant lists for categories (initially hidden, shown per selection) -->
<div class="restaurant-list" id="fastfoodList">
  <!-- Sample restaurants for Fast Food -->
  <div class="restaurant-card" onclick="showMenu('KFC Parow')">
    <img src="Images/RS KFC .jpeg" alt="KFC Parow" />
    <div class="details">
      <div>KFC, Parow</div>
      <div class="rating">4.4 â˜…</div>
      <div>Sponsored - 5 min</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
  <div class="restaurant-card" onclick="showMenu('Sannes Palace')">
    <img src="Images/RS PALACE .jpg" alt="Sannes Palace" />
    <div class="details">
      <div>Sannes Palace</div>
      <div class="rating">4.5 â˜…</div>
      <div>20 min - 0.5 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
   <div class="restaurant-card" onclick="showMenu('DK Spot & Kota')">
    <img src="Images/RS KOTA .jpg" alt="DK Spot & Kota" onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>DK Spot & Kota Restaurant</div>
      <div class="rating">4.0 â˜…</div>
      <div>Uber Eats HDP-Owned - 16 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
  <div class="restaurant-card" onclick="showMenu('Nondyebo Eatery')">
    <img src="Images/RS NONDYEBO.jpg" alt="Nondyebo Eatery" onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>Nondyebo Eatery</div>
      <div class="rating">3.3 â˜…</div>
      <div>10 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
</div>

<div class="restaurant-list" id="burgersList" style="display:none;">
  <!-- Burgers -->
  <div class="restaurant-card" onclick="showMenu('Rodeo Spur Halaal')">
    <img src="Images/spur.jpg" alt="Rodeo Spur Halaal" />
    <div class="details">
      <div>Rodeo Spur Halaal</div>
      <div class="rating">4.4 â˜…</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
  
   
  <div class="restaurant-card" onclick="showMenu('RocoMamas Rondebosch')">
    <img src="Images/img.jpg" alt="RocoMamas Rondebosch"
      onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>RocoMamas Rondebosch</div>
      <div class="rating">4.0 â˜…</div>
      <div>Uber Eats HDP-Owned - 16 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>

  <div class="restaurant-card" onclick="showMenu('Krispy King Rondebosch')">
    <img src="Images/fried_chicken.jpg" alt="Krispy King Rondebosch"
      onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>KRISPY KING RONDEBOSCH (HALAL)</div>
      <div class="rating">3.3 â˜…</div>
      <div>10 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>

</div>


<div class="restaurant-list" id="asianList" style="display:none;">
  <!-- Asian -->
  <div class="restaurant-card" onclick="showMenu('Khao Hom Halal Thai Cuisine')">
    <img src="Images/download.png" alt="Khao Hom Halal Thai Cuisine" />
    <div class="details">
      <div>Khao Hom Thai Cuisine</div>
      <div class="rating">4.4 â˜…</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
  
  <div class="restaurant-card" onclick="showMenu('Somma Asian Restaurant Rondebosch')">
    <img src="Images/asian_(1).jpg" alt="Somma Asian Restaurant Rondebosch"
      onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>Somma Asian Restaurant Rondebosch
</div>
      <div class="rating">4.0 â˜…</div>
      <div>Uber Eats HDP-Owned - 16 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>

</div>

<div class="restaurant-list" id="pizzaList" style="display:none;">
  <!-- Pizza -->
<div class="restaurant-card" onclick="showMenu('La Infernos Pizzeria (Kromboom')">
    <img src="Images/wood-pizza.png" alt="La Inferno's Pizzeria (Kromboom)"
      onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>La Inferno's Pizzeria (Kromboom)</div>
      <div class="rating">4.4 â˜…</div>
      <div>Sponsored - 5 min - 4.4 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>

  
  <div class="restaurant-card" onclick="showMenu('Romans Pizza ')">
    <img src="Images/roman_pizza.jpg" alt="Roman's Pizza "
      onclick="window.location.href='http://127.0.0.1:5501/user-app/client/public/restaurant_info.html'; event.stopPropagation();"/>
    <div class="details">
      <div>Roman's Pizza </div>
      <div class="rating">3.3 â˜…</div>
      <div>10 min - 0.6 km</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>

  <div class="restaurant-card" onclick="showMenu('Debonairs Pizza')">
    <img src="Images/download (1).png" alt="Debonairs Pizza" />
    <div class="details">
      <div>Debonairs Pizza</div>
      <div class="rating">4.0 â˜…</div>
    </div>
    <button class="fav" onclick="event.stopPropagation(); toggleFavorite(this)">â™¥</button>
  </div>
</div>

<!-- Notification -->
<div id="notification" style="display:none; position:fixed; top:20px; width:100%; z-index:9999; text-align:center;">
  <div style="background-color:#4CAF50; color:white; padding:10px; display:inline-block; border-radius:4px;">
    Sending notification...
  </div>
</div>

<!-- JavaScript: core functions from both snippets -->
<script>
function selectCategory(category) {
  // Hide all lists first
  document.getElementById("fastfoodList").style.display = "none";
  document.getElementById("burgersList").style.display = "none";
  document.getElementById("asianList").style.display = "none";
  document.getElementById("pizzaList").style.display = "none";

  // Show selected category
  if (category === "Fast Food") {
    document.getElementById("fastfoodList").style.display = "block";
  } else if (category === "Burgers") {
    document.getElementById("burgersList").style.display = "block";
  } else if (category === "Asian") {
    document.getElementById("asianList").style.display = "block";
  } else if (category === "Pizza") {
    document.getElementById("pizzaList").style.display = "block";
  }
}

function showMenu(name) {
  window.location.href = "restaurant_info.html?name=" + encodeURIComponent(name);
}

function toggleFavorite(btn) {
  btn.classList.toggle("active");
}

function showNotificationMessage(text, color = '#333') {
  let box = document.getElementById('notificationMessage');

  if (!box) {
    box = document.createElement('div');
    box.id = 'notificationMessage';
    box.style.position = 'fixed';
    box.style.bottom = '20px';
    box.style.left = '50%';
    box.style.transform = 'translateX(-50%)';
    box.style.padding = '12px 20px';
    box.style.borderRadius = '8px';
    box.style.color = '#fff';
    box.style.fontSize = '14px';
    box.style.zIndex = '9999';
    document.body.appendChild(box);
  }

  box.style.backgroundColor = color;
  box.innerText = text;

  setTimeout(() => {
    box.remove();
  }, 4000);
}

async function sendTwilioNotification(to, message) {
  showNotificationMessage('Sending notification...', '#2196F3');
  try {
    const response = await fetch('/notify/sms', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ to, message })
    });
    if (!response.ok) throw new Error('Server error');
    const data = await response.json();
    if (data.success === true) {
      showNotificationMessage('Notification sent successfully!', '#4CAF50');
      console.log('SMS sent:', data);
    } else {
      showNotificationMessage(data.error || 'Failed to send notification.', '#f44336');
      console.error('SMS failed:', data);
    }
  } catch (error) {
    console.error('Error sending SMS:', error);
    showNotificationMessage('Network error. Please try again.', '#f44336');
  }
}
</script>

<!-- Profile Modal Scripts and other functions (loadProfile, updatePassword, saveCardDetails, deleteUser, etc.) -->
<script>
const supabaseUrl = 'https://wbpgmgtoyzlnawvsfeiu.supabase.co'
const supabaseKey = process.env.SUPABASE_KEY; //  actual key
const supabase = createClient(supabaseUrl, supabaseKey)
const userId = localStorage.getItem('user_id');

// Fetch vendor data
async function fetchVendor() {
  const { data: vendor, error } = await supabase
    .from('vendor')
    .select(`
      id,
      vendor,
      item,
      price,
      stock,
      email,
      password,
      manage_item,
      manage_orders_Customer_name,
      manage_order_total,
      manage_order_status,
      manage_users,
      payment_history
    `);

  if (error) {
    console.error('Error fetching vendor:', error);
    return null;
  }
  return vendor;

}

window.openProfile = () => {
  document.getElementById('profileModal').style.display = 'flex';
  loadProfile();
}

window.closeProfile = () => {
  document.getElementById('profileModal').style.display = 'none';
}

window.updatePassword = async () => {
  const password = document.getElementById('password').value;
  const { error } = await supabase
    .from('User')
    .update({ password })
    .eq('id', userId);
  alert(error ? 'Password update failed' : 'Password updated');
}

window.saveCardDetails = async () => {
  const data = {
    card_type: document.getElementById('cardType').value,
    card_number: document.getElementById('cardNumber').value,
    cvv: document.getElementById('cvv').value,
    security_code: document.getElementById('securityCode').value
  };
  const { error } = await supabase.from('User').update(data).eq('id', userId);
  alert(error ? 'Card save failed' : 'Card saved');
}

window.deleteUser = async () => {
  if (!confirm('Delete account permanently?')) return;
  await supabase.from('User').delete().eq('id', userId);
  localStorage.clear();
  location.href = 'http://127.0.0.1:5501/user-app/register_home.html';
}
</script>
<script src="smsAndEmailAPI.js"async></script>


<script src="server/supabase/supabaseClient.js"async></script>

<script src="client/public/functions/live-tracking.js" async></script>
<script src="client/public/functions/mainTwilioFunction.js" async></script>
<script src="client/public/functions/token.js" async></script>
<script src="client/public/functions/sendSMS.js" async></script>
<script src="client/public/functions/twilio.js" async></script>
<script src="client/public/functions/map.js" async></script>
<script src="client/public/functions/payfast.js" async></script>
<script src="client/public/functions/notification.js" async></script>
<script src="client/public/functions/mapFunctions.js" async></script>
<script src="client/public/functions/pinpoint.js" async></script>
<script src="client/public/functions/pinpointConfig.js" async></script>
<script src="client/public/functions/payfast.js" async></script>
<script src="client/public/functions/payfast_do_onsite_payment.js" async></script>

<script src="client/public/components/createPayFastPayment.js" async></script>
<script src="client/public/components/payfast.js" async></script>
<script src="client/public/components/PayfastCheckout.js" async></script>
<script src="client/public/components/real_time_data_fetching.js" async></script>

<script src="client/public/hooks/useAuth.js" async></script>
<script src="client/public/hooks/useDebounce.js" async></script>
<script src="client/public/hooks/useFetch.js" async></script>
<script src="client/public/hooks/LocalStorage.js" async></script>

<script src="client/public/pages/CheckoutPage.jsx" async></script>
<script src="client/public/pages/OrderSummary.js" async></script>

<script src="server/supabase/node-payfast.js" async></script>
<script src="server/supabase/client.js" async></script>
<script src="server/supabase/middleware.js" async></script>
<script src="server/supabase/.env.local" async></script>
<script src="server/supabase/supabaseClient.js" async></script>
<script src="server/.env.client" async></script>
<script src="server/api.client.js" async></script>
<script src="server/map.js" async></script>
<script src="server/maps.client.js" async></script>
<script src="server/notification.client.js" async></script>
<script src="server/payfast.client.js" async></script>
<script src="server/twilioNotifiaction.js" async></script>
<script src="server/routes.js" async></script>
<script src="server/server.js" async></script>
<script src="utils/payfastAPI.js" async></script>

</body>
</html>
