<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Chat App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Google Platform Library -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f8;
}
/* Your existing styles... */
.top-bar {
  background: #ef0606;
  color: #fff;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.top-bar button {
  background: #fff;
  color: #ed0808;
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}
.chat-container {
  max-width: 420px;
  margin: 20px auto;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  display: flex;
  flex-direction: column;
  height: 75vh;
}
.messages {
  flex: 1;
  padding: 14px;
  overflow-y: auto;
}
.msg {
  margin-bottom: 10px;
  padding: 8px 10px;
  border-radius: 10px;
  max-width: 80%;
  font-size: 14px;
}
.user {
  background: #e8f0fe;
  color: #f20909;
  margin-left: auto;
  text-align: right;
}
.bot {
  background: #f1f3f4;
  color: #333;
  margin-right: auto;
}
.input-box {
  display: flex;
  border-top: 1px solid #ddd;
}
.input-box input {
  flex: 1;
  padding: 12px;
  border: none;
  outline: none;
}
.input-box button {
  background: #f40404;
  color: #fff;
  border: none;
  padding: 12px 18px;
  cursor: pointer;
}
</style>
</head>
<body>

<div class="top-bar" id="topBar">
  <div>AI Chat Bot ðŸ¤–</div>
  <div id="g_id_onload"></div>
  <div id="googleSignInButton" style="margin-left: 10px;"></div>
</div>

<div class="chat-container">
  <div class="messages" id="messages"></div>
  <div class="input-box">
    <input id="messageInput" disabled placeholder="Please log inâ€¦" />
    <button id="sendBtn" disabled onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
// Your Client ID
const CLIENT_ID = '866867707128-mq963ediu3mijf16r27c8e1fgnmp2h3f';

// Initialize Google Sign-In
window.onload = () => {
  google.accounts.id.initialize({
    client_id: CLIENT_ID,
    callback: handleGoogleSignIn
  });
  google.accounts.id.renderButton(
    document.getElementById("googleSignInButton"),
    { theme: "outline", size: "large" }
  );
};

// Handle sign-in success
function handleGoogleSignIn(response) {
  const credential = response.credential;
  const payload = parseJwt(credential);
  window.currentUser = {
    name: payload.name,
    email: payload.email,
    avatar: payload.picture
  };
  updateUIAfterLogin();
  addMessage("Logged in successfully âœ…", "bot");
}

// Decode JWT
function parseJwt(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(
    atob(base64)
      .split('')
      .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
      .join('')
  );
  return JSON.parse(jsonPayload);
}

// UI after login
function updateUIAfterLogin() {
  document.getElementById("topBar").innerHTML = `
    <div>Welcome, ${currentUser.name} ðŸ‘‹</div>
    <div style="display:flex;align-items:center;gap:10px">
      <img src="${currentUser.avatar}" style="width:32px;height:32px;border-radius:50%">
      <button onclick="logout()">Logout</button>
    </div>
  `;
  document.getElementById("messageInput").disabled = false;
  document.getElementById("sendBtn").disabled = false;
  document.getElementById("messageInput").placeholder = "Type your messageâ€¦";
}

// Logout
function logout() {
  location.reload();
}

// Chat functions
function sendMessage() {
  const input = document.getElementById("messageInput");
  const text = input.value.trim();
  if (!text) return;
  addMessage(text, "user");
  input.value = "";
  const typing = addMessage("Typingâ€¦", "bot");
  setTimeout(() => {
    typing.remove();
    addMessage(generateRemoteAIReply(text), "bot");
  }, 900);
}

async function generateRemoteAIReply(message) {
  // Replace URL with your AI chatbot API endpoint
  const apiUrl = 'https://api.otheraibot.com/getResponse';

  try {
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: message })
    });
    
    const data = await response.json();
    // Assume the API returns { reply: "..." }
    return `ðŸ¤– AI Response:\n\n${data.reply}`;
    
  } catch (error) {
    console.error('Error connecting to AI bot:', error);
    return `ðŸ¤– Sorry, I couldn't connect to the AI bot right now.`;
  }
}

function addMessage(text, type) {
  const div = document.createElement("div");
  div.className = `msg ${type}`;
  div.textContent = text;
  document.getElementById("messages").appendChild(div);
  div.scrollIntoView({ behavior: "smooth" });
  return div;
}
</script>

</body>
</html>