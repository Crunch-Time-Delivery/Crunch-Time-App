<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout</title>

<style>
body{margin:0;font-family:Arial;background:#f5f5f5}
.hidden{display:none}
.container{max-width:420px;margin:auto;padding-bottom:90px}
.header{background:#fff;padding:15px;font-weight:bold;text-align:center}
.map img{width:100%;height:200px;object-fit:cover}
.card,.tips{background:#fff;margin:12px;padding:14px;border-radius:14px}
.address{display:flex;justify-content:space-between;align-items:center}
.voucher{background:#ffb84d;padding:14px;margin:12px;border-radius:10px;text-align:center;font-weight:bold;color:#fff;cursor:pointer}

.summary-row{display:flex;justify-content:space-between;margin-bottom:6px}
.total-row{border-top:1px dashed #ddd;padding-top:8px;font-weight:bold;font-size:16px}

.method{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee}
.method-left{display:flex;align-items:center;gap:10px}
.method img{width:32px}

.bottom-bar{
  position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:420px;background:red;color:#fff;
  padding:16px;display:flex;justify-content:space-between;
  font-weight:bold;cursor:pointer
}

/* Tips */
.tip-options{display:flex;gap:10px;margin-top:10px}
.tip-btn{
  flex:1;padding:10px;border-radius:10px;
  border:1px solid #ddd;background:#fff;
  cursor:pointer;font-weight:bold
}
.tip-btn.active{background:red;color:#fff;border-color:red}

/* Popup */
.popup-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.5);
  display:none;align-items:center;justify-content:center;z-index:1000
}
.popup{
  background:#fff;padding:16px;width:280px;border-radius:12px
}
.popup input,.popup button{
  width:100%;padding:10px;margin-top:10px
}
</style>
</head>

<body>

<div class="container">
<div class="header">Checkout</div>

<!-- MAP -->
<div class="map">
<img id="staticMap" src="" alt="Delivery Map">
</div>

<!-- ADDRESS -->
<div class="card address">
  <div>
    <strong id="deliveryAddress">Loading address...</strong><br>
    <small>Delivery 25 – 35 min</small>
  </div>
  ✏️
</div>

<div class="voucher" onclick="openVoucher()">Input voucher coupon</div>

<!-- Tips -->
<div class="tips">
<strong>Add a tip for your driver</strong>
<div class="tip-options">
<button class="tip-btn" onclick="setTip(5,this)">R5</button>
<button class="tip-btn" onclick="setTip(10,this)">R10</button>
<button class="tip-btn" onclick="setTip(15,this)">R15</button>
</div>
</div>

<div class="card">
<div class="summary-row"><span>Subtotal</span><span id="subtotal">R0.00</span></div>
<div class="summary-row"><span>Discount</span><span id="discount">R0.00</span></div>
<div class="summary-row"><span>Service Fee</span><span>R10.00</span></div>
<div class="summary-row"><span>Delivery Fee</span><span>R20.00</span></div>
<div class="summary-row"><span>Tip</span><span id="tipAmount">R0.00</span></div>
<div class="summary-row total-row"><span>Total</span><span id="total">R0.00</span></div>
</div>

<div class="card">
<div class="method">
<div class="method-left">
<img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png">
Instant EFT
</div>
<input type="radio" name="paymethod" value="eft" checked>
</div>

<div class="method">
<div class="method-left">
<img src="https://cdn-icons-png.flaticon.com/512/891/891462.png">
Card (Visa / MasterCard)
</div>
<input type="radio" name="paymethod" value="card">
</div>
</div>
</div>

<div class="bottom-bar" onclick="payNow()">
<span>Place Order</span>
<span id="barTotal">R0.00</span>
</div>

<!-- Voucher Popup -->
<div class="popup-overlay" id="voucherPopup">
<div class="popup">
<strong>Enter Voucher Code</strong>
<input id="voucherCode" placeholder="SAVE20">
<button onclick="applyVoucher()">Apply</button>
</div>
</div>

<script>
/* ================= LOCATION LOAD ================= */

function loadDeliveryLocation() {
  const coords = localStorage.getItem("deliveryCoords");
  const address = localStorage.getItem("deliveryAddress");

  const mapImg = document.getElementById("staticMap");
  const addressDiv = document.getElementById("deliveryAddress");

  if (coords && address) {
    const pos = JSON.parse(coords);
    const mapUrl = `https://maps.googleapis.com/maps/api/staticmap?center=${pos.lat},${pos.lng}&zoom=15&size=600x300&markers=color:red|${pos.lat},${pos.lng}&key=AIzaSyB9sNhi824hNncjfW7HHzaI_s8JtWGfM0Q`;

    mapImg.src = mapUrl;
    addressDiv.innerText = address;
  } else {
    mapImg.src =
      "https://maps.googleapis.com/maps/api/staticmap?center=Kenilworth,CapeTown&zoom=14&size=600x300";
    addressDiv.innerText = "17 Bishop Park Way";
  }
}

/* ================= CHECKOUT LOGIC ================= */

let subtotal = 170;
let discount = 0;
let tip = 0;
const serviceFee = 10;
const deliveryFee = 20;

function recalc(){
  const total = subtotal - discount + serviceFee + deliveryFee + tip;
  document.getElementById("subtotal").innerText = "R" + subtotal.toFixed(2);
  document.getElementById("discount").innerText = "-R" + discount.toFixed(2);
  document.getElementById("tipAmount").innerText = "R" + tip.toFixed(2);
  document.getElementById("total").innerText = "R" + total.toFixed(2);
  document.getElementById("barTotal").innerText = "R" + total.toFixed(2);
}

function setTip(amount, btn){
  tip = amount;
  document.querySelectorAll(".tip-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  recalc();
}

function openVoucher(){
  document.getElementById("voucherPopup").style.display="flex";
}

function applyVoucher(){
  if(document.getElementById("voucherCode").value.toUpperCase()==="SAVE20"){
    discount = 20;
  }
  document.getElementById("voucherPopup").style.display="none";
  recalc();
}

function payNow(){
  alert("Payment submitted");
}

/* INIT */
loadDeliveryLocation();
recalc();
</script>

</body>
</html>
