<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vendor App</title>
<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
<style>
  /* Your styles here (same as before) */
  body { font-family: sans-serif; background:#f0f0f0; margin:0; }
  .header { position: fixed; top:0; width:100%; height:60px; background:#fff; display:flex; align-items:center; justify-content:space-between; padding:0 20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); z-index:999; }
  .vendor-text { font-weight:bold; color:red; font-size:1.2em; }
  .menu-container { display: flex; align-items: center; position: relative; margin-left: -20px; }
  .profile-btn { background:#ff0000; color:#fff; padding:8px 12px; border:none; border-radius:50px; cursor:pointer; }
  .dropdown { display:none; position:absolute; right:20px; top:60px; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); min-width:200px; z-index:1000; }
  .dropdown.show { display:block; }
  .dropdown a { display:block; padding:10px 15px; text-decoration:none; color:#333; }
  .dropdown a:hover { background:#f0f0f0; }
  .container { margin-top:80px; padding:20px; max-width:1200px; margin-left:auto; margin-right:auto; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  .management-buttons { margin-bottom:10px; }
  .management-buttons button { margin-right:5px; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; }
  .btn-primary { background:#f90101; color:#fff; }
  .btn-secondary { background:#f60202; color:#fff; }
  .btn-payment-history { background:#fa0303; color:#fff; }
  .section { display:none; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:8px; }
  th { background:#f0f0f0; }
  .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content: center; align-items: center; z-index: 2000; }
  .modal.show { display: flex; }
  .modal-box { background: #fff; padding: 20px; border-radius: 8px; width: 300px; display: flex; flex-direction: column; }
  .modal-box input, .modal-box select { margin-bottom: 10px; padding: 8px; width: 100%; }
  .modal-box button { margin-top: 10px; padding: 8px; border: none; border-radius: 4px; cursor: pointer; }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="vendor-text">Vendor</div>
  <div class="menu-container">
    <button class="profile-btn" id="profileBtn" onclick="toggleDropdown()" style="margin-left:50px;">
      <i class="fas fa-user-circle"></i> Menu
    </button>
    <div class="dropdown" id="profileDropdown">
      <a href="#" onclick="showManagement('items'); return false;">Manage Items</a>
      <a href="#" onclick="showManagement('orders'); return false;">Manage Orders</a>
      <a href="#" onclick="showManagement('users'); return false;">Manage Users</a>
      <a href="#" onclick="showPaymentHistory(); return false;">Payment History</a>
      <a href="#" onclick="logout(); return false;">Logout</a>
    </div>
  </div>
</div>

<div class="container">
  <!-- Management Buttons -->
  <div class="management-buttons">
    <button class="btn-primary" onclick="showManagement('items')">Manage Items</button>
    <button class="btn-primary" onclick="showManagement('orders')">Manage Orders</button>
    <button class="btn-primary" onclick="showManagement('users')">Manage Users</button>
    <button class="btn-payment-history" onclick="showPaymentHistory()">Payment History</button>
  </div>

  <!-- Sections -->
  <div id="section-items" class="section">
    <h3>Items</h3>
    <button class="btn-secondary" onclick="openItemForm()">Add Item</button>
    <div id="itemsTable"></div>
  </div>
  <div id="section-orders" class="section">
    <h3>Orders</h3>
    <button class="btn-secondary" onclick="promptAddOrder()">Add Order</button>
    <div id="ordersTable"></div>
  </div>
  <div id="section-users" class="section">
    <h3>Users</h3>
    <button class="btn-secondary" onclick="openUserForm()">Add User</button>
    <div id="usersTable"></div>
  </div>
  <div id="section-payment-history" class="section">
    <h3>Payment History</h3>
    <button onclick="fetchPayments()">Refresh</button>
    <div id="paymentHistoryContainer"></div>
  </div>
</div>

<!-- Modals -->
<div id="itemFormModal" class="modal">
  <div class="modal-box">
    <h4 id="itemFormTitle">Add Item</h4>
    <input id="itemVendor" placeholder="Vendor" />
    <input id="itemName" placeholder="Item" />
    <input id="itemPrice" placeholder="Price" type="number" />
    <select id="itemStock">
      <option value="In Stock">In Stock</option>
      <option value="Out of Stock">Out of Stock</option>
    </select>
    <button onclick="saveItem()">Save</button>
    <button onclick="closeItemForm()">Cancel</button>
  </div>
</div>

<div id="userFormModal" class="modal">
  <div class="modal-box">
    <h4 id="userFormTitle">Add User</h4>
    <input id="userEmail" placeholder="Email" />
    <input id="userName" placeholder="Name" />
    <button onclick="saveUser()">Save</button>
    <button onclick="closeUserForm()">Cancel</button>
  </div>
</div>

<div id="orderFormModal" class="modal">
  <div class="modal-box">
    <h4 id="orderFormTitle">Add Order</h4>
    <p>Order form goes here...</p>
    <button onclick="closeOrderForm()">Close</button>
  </div>
</div>

<script>
  // Initialize Supabase
  const supabaseUrl = 'https://wbpgmgtoyzlnawvsfeiu.supabase.co';
  const supabaseKey = 'YOUR_SUPABASE_KEY'; // <-- Replace with your key
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  function toggleDropdown() {
    document.getElementById('profileDropdown').classList.toggle('show');
  }

  function showManagement(type) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    if (type==='items') { document.getElementById('section-items').style.display='block'; renderItems(); }
    if (type==='orders') { document.getElementById('section-orders').style.display='block'; renderOrders(); }
    if (type==='users') { document.getElementById('section-users').style.display='block'; renderUsers(); }
  }

  function showPaymentHistory() {
    fetchPayments();
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById('section-payment-history').style.display='block';
  }

  // Manage Items
  function openItemForm() {
    document.getElementById('itemFormTitle').innerText = 'Add Item';
    document.getElementById('itemVendor').value = '';
    document.getElementById('itemName').value = '';
    document.getElementById('itemPrice').value = '';
    document.getElementById('itemStock').value = 'In Stock';
    document.getElementById('itemFormModal').style.display='flex';
  }
  function saveItem() {
    // Save logic here 
    closeItemForm();
  }
  function closeItemForm() {
    document.getElementById('itemFormModal').style.display='none';
  }

  // Manage Users
  function openUserForm() {
    document.getElementById('userFormTitle').innerText='Add User';
    document.getElementById('userEmail').value='';
    document.getElementById('userName').value='';
    document.getElementById('userFormModal').style.display='flex';
  }
  function saveUser() {
    // Save logic here
    closeUserForm();
  }
  function closeUserForm() {
    document.getElementById('userFormModal').style.display='none';
  }

  // Order modal
  function promptAddOrder() {
    alert('Open order form modal here...');
  }
  function closeOrderForm() {
    document.getElementById('orderFormModal').style.display='none';
  }

  // Fetch Payment History
async function fetchPayments() {
  const { data, error } = await supabase
    .from('payment_history')
    .select('*')
    .order('payment_date', { ascending: false });
  if (error) {
    console.error('Error fetching payment history:', error);
    document.getElementById('paymentHistoryContainer').innerHTML = '<p>Error loading payment history.</p>';
    return;
  }
  payments = data; // Save data globally
  renderPaymentHistory(); // Call render to display
}
    const container = document.getElementById('paymentHistoryContainer');
    if (data.length === 0) {
      container.innerHTML = '<p>No payment history available.</p>';
      return;
    }
    let html = `
      <table>
        <thead>
          <tr>
            <th>Payment ID</th>
            <th>Order ID</th>
            <th>User Name</th>
            <th>User Email</th>
            <th>Method</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
    `;
    data.forEach(p => {
      html += `
        <tr>
          <td>${p.payment_id}</td>
          <td>${p.order_id}</td>
          <td>${p.user_name}</td>
          <td>${p.user_email}</td>
          <td>${p.payment_method}</td>
          <td>$${p.amount.toFixed(2)}</td>
          <td>${new Date(p.payment_date).toLocaleString()}</td>
          <td>${p.status}</td>
        </tr>
      `;
    });
    html += `</tbody></table>`;
    document.getElementById('paymentHistoryContainer').innerHTML = html;
  }

  window.onload = () => {
    // Optional: show default section
  };
</script>
</body>
</html>