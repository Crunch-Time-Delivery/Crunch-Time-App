<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vendor App</title>
<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
  body { font-family: sans-serif; background:#f0f0f0; margin:0; }
  /* Header styling */
  .header {
    position: fixed; top:0; width:100%; height:60px; background:#fff; display:flex; align-items:center; justify-content:space-between; padding:0 20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); z-index:999;
  }
  .vendor-text { font-weight:bold; color:red; font-size:1.2em; }
.menu-container {
  display: flex;
  align-items: center;
  position: relative;
  margin-left: -20px; /* move the whole button more to the left */
}
  .profile-btn { background:#ff0000; color:#fff; padding:8px 12px; border:none; border-radius:50px; cursor:pointer; }
  .dropdown { display:none; position:absolute; right:20px; top:60px; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); min-width:200px; z-index:1000; }
  .dropdown.show { display:block; }
  .dropdown a { display:block; padding:10px 15px; text-decoration:none; color:#333; }
  .dropdown a:hover { background:#f0f0f0; }

  /* Container styles */
  .container {
    margin-top:80px; padding:20px; max-width:1200px; margin-left:auto; margin-right:auto; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  /* Management buttons */
  .management-buttons { margin-bottom:10px; }
  .management-buttons button { margin-right:5px; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; }
  .btn-primary { background:#f90101; color:#fff; }
  .btn-secondary { background:#f60202; color:#fff; }
  .btn-payment-history { background:#fa0303; color:#fff; }

  /* Sections */
  .section { display:none; }
  /* Tables styling */
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:8px; }
  th { background:#f0f0f0; }
  /* Modals styling */
  .modal {
    display:flex; align-items:center; justify-content:center; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;
  }
  .modal-box { background:#fff; padding:20px; border-radius:8px; width:400px; max-height:80%; overflow-y:auto; }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="vendor-text">Vendor</div>
  <div class="menu-container">
<button class="profile-btn" id="profileBtn" onclick="toggleDropdown()" style="margin-left:50px;">
  <i class="fas fa-user-circle"></i> Menu
</button>
    <div class="dropdown" id="profileDropdown">
      <a href="#" onclick="showManagement('items');">Manage Items</a>
      <a href="#" onclick="showManagement('orders');">Manage Orders</a>
      <a href="#" onclick="showManagement('users');">Manage Users</a>
      <a href="#" onclick="showPaymentHistory()">Payment History</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container">
  <!-- Management Buttons -->
  <div class="management-buttons">
    <button class="btn-primary" onclick="showManagement('items')">Manage Items</button>
    <button class="btn-primary" onclick="showManagement('orders')">Manage Orders</button>
    <button class="btn-primary" onclick="showManagement('users')">Manage Users</button>
    <button class="btn-payment-history" onclick="showPaymentHistory()">Payment History</button>
  </div>

  <!-- Sections -->
  <div id="section-items" class="section">
    <h3>Items</h3>
    <button class="btn-secondary" onclick="openItemForm()">Add Item</button>
    <div id="itemsTable"></div>
  </div>
  <div id="section-orders" class="section">
    <h3>Orders</h3>
    <button class="btn-secondary" onclick="promptAddOrder()">Add Order</button>
    <div id="ordersTable"></div>
  </div>
  <div id="section-users" class="section">
    <h3>Users</h3>
    <button class="btn-secondary" onclick="openUserForm()">Add User</button>
    <div id="usersTable"></div>
  </div>
  <div id="section-payment-history" class="section">
    <h3>Payment History</h3>
    <button onclick="showPaymentHistory()">Refresh</button>
    <div id="paymentHistoryContainer"></div>
  </div>
</div>

<!-- Add/Edit Item Modal -->
<div id="itemFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="itemFormTitle">Add Item</h4>
    <input id="itemVendor" placeholder="Vendor" />
    <input id="itemName" placeholder="Item" />
    <input id="itemPrice" placeholder="Price" type="number" />
    <select id="itemStock">
      <option value="In Stock">In Stock</option>
      <option value="Out of Stock">Out of Stock</option>
    </select>
    <button onclick="saveItem()">Save</button>
    <button onclick="closeItemForm()">Cancel</button>
  </div>
</div>

<!-- Add/Edit User Modal -->
<div id="userFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="userFormTitle">Add User</h4>
    <input id="userEmail" placeholder="Email" />
    <input id="userName" placeholder="Name" />
    <button onclick="saveUser()">Save</button>
    <button onclick="closeUserForm()">Cancel</button>
  </div>
</div>

<!-- Notification -->
<div id="notification"></div>

<!-- Scripts: core logic and src connections -->
 <script src="supabaseClient.js" async></script> 
<script>
  // Data arrays
  let items = [];
  let orders = [];
  let users = [];
  let payments = [];

  // Toggle dropdown menu
  function toggleDropdown() {
    document.getElementById('profileDropdown').classList.toggle('show');
  }

  // Show management sections
  function showManagement(type) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    if (type==='items') { document.getElementById('section-items').style.display='block'; renderItems(); }
    if (type==='orders') { document.getElementById('section-orders').style.display='block'; renderOrders(); }
    if (type==='users') { document.getElementById('section-users').style.display='block'; renderUsers(); }
  }

  // Show payment history
  function showPaymentHistory() {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById('section-payment-history').style.display='block';
    renderPaymentHistory();
  }

  // Show specific section
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById(id).style.display='block';
  }

  // Logout
  function logout() {
    localStorage.clear();
    alert('Logged out');
  }

  // =================== Item CRUD ===================

  function renderItems() {
    const container = document.getElementById('itemsTable');
    container.innerHTML='';
    if (items.length===0) { container.innerHTML='No items'; return; }
    const table = document.createElement('table');
    table.innerHTML=`<thead><tr><th>Vendor</th><th>Item</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead>`;
    const tbody = document.createElement('tbody');
    items.forEach((it,i) => {
      const row=tbody.insertRow();
      row.insertCell().innerText=it.vendor;
      row.insertCell().innerText=it.item;
      row.insertCell().innerText=`R ${it.price.toFixed(2)}`;
      row.insertCell().innerText=it.stock;
      const cell=row.insertCell();
      const editBtn=document.createElement('button');
      editBtn.innerText='Edit';
      editBtn.onclick=()=>editItem(i);
      const deleteBtn=document.createElement('button');
      deleteBtn.innerText='Delete';
      deleteBtn.style.background='#f44336';
      deleteBtn.onclick=()=>deleteItem(i);
      cell.appendChild(editBtn);
      cell.appendChild(deleteBtn);
    });
    table.appendChild(tbody);
    container.innerHTML='';
    container.appendChild(table);
  }

  function openItemForm() {
    document.getElementById('itemFormTitle').innerText='Add Item';
    document.getElementById('itemVendor').value='';
    document.getElementById('itemName').value='';
    document.getElementById('itemPrice').value='';
    document.getElementById('itemStock').value='In Stock';
    document.getElementById('itemFormModal').dataset.editIndex='-1';
    document.getElementById('itemFormModal').style.display='flex';
  }

  function editItem(i) {
    const it=items[i];
    document.getElementById('itemFormTitle').innerText='Edit Item';
    document.getElementById('itemVendor').value=it.vendor;
    document.getElementById('itemName').value=it.item;
    document.getElementById('itemPrice').value=it.price;
    document.getElementById('itemStock').value=it.stock;
    document.getElementById('itemFormModal').dataset.editIndex=i;
    document.getElementById('itemFormModal').style.display='flex';
  }

  function saveItem() {
    const i=Number(document.getElementById('itemFormModal').dataset.editIndex);
    const vendor = document.getElementById('itemVendor').value.trim();
    const item = document.getElementById('itemName').value.trim();
    const price = parseFloat(document.getElementById('itemPrice').value);
    const stock = document.getElementById('itemStock').value;
    if (!vendor || !item || isNaN(price)) { alert('Fill all fields'); return; }
    if (i>=0) { items[i]= {vendor, item, price, stock}; }
    else { items.push({vendor, item, price, stock}); }
    closeItemForm();
    renderItems();
  }

  function deleteItem(i) {
    if (confirm('Delete this item?')) { items.splice(i,1); renderItems(); }
  }

  function closeItemForm() {
    document.getElementById('itemFormModal').style.display='none';
  }

  // =================== Orders CRUD ===================

  function renderOrders() {
    const container = document.getElementById('ordersTable');
    container.innerHTML='';
    if (orders.length===0) { container.innerHTML='No orders'; return; }
    const table = document.createElement('table');
    table.innerHTML=`<thead><tr><th>ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>`;
    const tbody = document.createElement('tbody');
    orders.forEach((o,i) => {
      const row=tbody.insertRow();
      row.insertCell().innerText=o.id;
      row.insertCell().innerText=o.customer;
      row.insertCell().innerText=`R ${o.total.toFixed(2)}`;
      row.insertCell().innerText=o.status;
      const cell=row.insertCell();
      const editBtn=document.createElement('button');
      editBtn.innerText='Edit';
      editBtn.onclick=()=>editOrder(i);
      const deleteBtn=document.createElement('button');
      deleteBtn.innerText='Delete';
      deleteBtn.style.background='#f44336';
      deleteBtn.onclick=()=>deleteOrder(i);
      cell.appendChild(editBtn);
      cell.appendChild(deleteBtn);
    });
    table.appendChild(tbody);
    document.getElementById('ordersTable').innerHTML='';
    document.getElementById('ordersTable').appendChild(table);
  }

  function promptAddOrder() {
    const customer=prompt('Customer name:');
    const totalStr=prompt('Total R:');
    const status=prompt('Status (Pending/Delivered):');
    const total=parseFloat(totalStr);
    if (!customer || isNaN(total) || !status) { alert('Invalid input'); return; }
    const newOrder={id: orders.length+1, customer, total, status};
    orders.push(newOrder);
    renderOrders();
  }

  function editOrder(i) {
    const o=orders[i];
    const newStatus=prompt('Set status:', o.status);
    if (newStatus) { o.status=newStatus; renderOrders(); }
  }

  function deleteOrder(i) {
    if (confirm('Delete this order?')) { orders.splice(i,1); renderOrders(); }
  }

  // =================== Users CRUD ===================

  function renderUsers() {
    const container = document.getElementById('usersTable');
    container.innerHTML='';
    if (users.length===0) { container.innerHTML='No users'; return; }
    const table = document.createElement('table');
    table.innerHTML=`<thead><tr><th>Email</th><th>Name</th><th>Actions</th></tr></thead>`;
    const tbody = document.createElement('tbody');
    users.forEach((u,i) => {
      const row=tbody.insertRow();
      row.insertCell().innerText=u.email;
      row.insertCell().innerText=u.name;
      const cell=row.insertCell();
      const editBtn=document.createElement('button');
      editBtn.innerText='Edit';
      editBtn.onclick=()=>editUser(i);
      const deleteBtn=document.createElement('button');
      deleteBtn.innerText='Delete';
      deleteBtn.style.background='#f44336';
      deleteBtn.onclick=()=>deleteUser(i);
      cell.appendChild(editBtn);
      cell.appendChild(deleteBtn);
    });
    table.appendChild(tbody);
    document.getElementById('usersTable').innerHTML='';
    document.getElementById('usersTable').appendChild(table);
  }

  function openUserForm() {
    document.getElementById('userFormTitle').innerText='Add User';
    document.getElementById('userEmail').value='';
    document.getElementById('userName').value='';
    document.getElementById('userFormModal').dataset.editIndex='-1';
    document.getElementById('userFormModal').style.display='flex';
  }

  function editUser(i) {
    const u=users[i];
    document.getElementById('userFormTitle').innerText='Edit User';
    document.getElementById('userEmail').value=u.email;
    document.getElementById('userName').value=u.name;
    document.getElementById('userFormModal').dataset.editIndex=i;
    document.getElementById('userFormModal').style.display='flex';
  }

  function saveUser() {
    const i=Number(document.getElementById('userFormModal').dataset.editIndex);
    const email=document.getElementById('userEmail').value.trim();
    const name=document.getElementById('userName').value.trim();
    if (!email || !name) { alert('Fill all fields'); return; }
    if (i>=0) { users[i]= {email, name}; }
    else { users.push({email, name}); }
    closeUserForm();
    renderUsers();
  }

  function deleteUser(i) {
    if (confirm('Delete this user?')) { users.splice(i,1); renderUsers(); }
  }

  function closeUserForm() {
    document.getElementById('userFormModal').style.display='none';
  }

  // =================== Payment History ===================

  function showPaymentHistory() {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById('section-payment-history').style.display='block';
    renderPaymentHistory();
  }

  function renderPaymentHistory() {
    const container = document.getElementById('paymentHistoryContainer');
    container.innerHTML='';
    if (payments.length===0) { container.innerHTML='No payment history.'; return; }
    const table=document.createElement('table');
    table.innerHTML=`<thead><tr><th>Amount</th><th>Method</th></tr></thead>`;
    const tbody=document.createElement('tbody');
    payments.forEach(p => {
      const row=tbody.insertRow();
      row.insertCell().innerText=`R ${p.amount.toFixed(2)}`;
      row.insertCell().innerText=p.method;
    });
    table.appendChild(tbody);
    container.innerHTML='';
    container.appendChild(table);
  }

  // =================== Modal handlers ===================

  function openItemForm() {
    document.getElementById('itemFormTitle').innerText='Add Item';
    document.getElementById('itemVendor').value='';
    document.getElementById('itemName').value='';
    document.getElementById('itemPrice').value='';
    document.getElementById('itemStock').value='In Stock';
    document.getElementById('itemFormModal').dataset.editIndex='-1';
    document.getElementById('itemFormModal').style.display='flex';
  }

  function closeItemForm() { document.getElementById('itemFormModal').style.display='none'; }

  function saveItem() {
    const i=Number(document.getElementById('itemFormModal').dataset.editIndex);
    const vendor = document.getElementById('itemVendor').value.trim();
    const item = document.getElementById('itemName').value.trim();
    const price = parseFloat(document.getElementById('itemPrice').value);
    const stock = document.getElementById('itemStock').value;
    if (!vendor || !item || isNaN(price)) { alert('Fill all fields'); return; }
    if (i>=0) { items[i]= {vendor, item, price, stock}; }
    else { items.push({vendor, item, price, stock}); }
    closeItemForm();
    renderItems();
  }

  function deleteItem(i) {
    if (confirm('Delete this item?')) { items.splice(i,1); renderItems(); }
  }

  // =================== User Modal Handlers ===================

  function openUserForm() {
    document.getElementById('userFormTitle').innerText='Add User';
    document.getElementById('userEmail').value='';
    document.getElementById('userName').value='';
    document.getElementById('userFormModal').dataset.editIndex='-1';
    document.getElementById('userFormModal').style.display='flex';
  }
  function closeUserForm() { document.getElementById('userFormModal').style.display='none'; }

  function saveUser() {
    const i=Number(document.getElementById('userFormModal').dataset.editIndex);
    const email=document.getElementById('userEmail').value.trim();
    const name=document.getElementById('userName').value.trim();
    if (!email || !name) { alert('Fill all fields'); return; }
    if (i>=0) { users[i]= {email, name}; }
    else { users.push({email, name}); }
    closeUserForm();
    renderUsers();
  }

</script>
<script src="smsAndEmailAPI.js"async></script>

<!-- External scripts for your project -->
<script src="client/public/functions/createPayFastPayment.js" async></script>
<script src="client/public/functions/mainTwilioFunction.js" async></script>
<script src="client/public/functions/token.js" async></script>
<script src="client/public/functions/sendSMS.js" async></script>
<script src="client/public/functions/twilio.js" async></script>

<script src="client/public/components/client_side_payment.js" async></script>
<script src="client/public/components/save_payment.js" async></script>
<script src="client/public/components/real_time_data_fetching.js" async></script>

<script src="client/public/hooks/useAuth.js" async></script>
<script src="client/public/hooks/useDebounce.js" async></script>
<script src="client/public/hooks/useFetch.js" async></script>
<script src="client/public/hooks/LocalStorage.js" async></script>

<script src="client/public/pages/ManageItemsPage.jsx" async></script>
<script src="client/public/pages/MangementSection.js" async></script>
<script src="client/public/pages/ManageOrdersPage.jsx" async></script>
<script src="client/public/pages/ManageUsersPage.jsx" async></script>
<script src="client/public/pages/PaymentHistoryPage.jsx" async></script>
<script src="client/public/pages/PaymentSuccess.jsx" async></script>

<script src="server/supabase/.env.local" async></script>
<script src="server/supabase/supabaseClient.js" async></script>

<script src="server/.env.client" async></script>
<script src="server/api.client.js" async></script>
<script src="server/map.js" async></script>
<script src="server/maps.client.js" async></script>
<script src="server/notification.client.js" async></script>
<script src="server/payfast.client.js" async></script>
<script src="server/twilioNotifiaction.js" async></script>
<script src="server/routes.js" async></script>
<script src="server/server.js" async></script>
<script src="utils/payfastAPI.js" async></script>
</body>
</html>