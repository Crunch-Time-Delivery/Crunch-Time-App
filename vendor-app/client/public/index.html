<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vendor App</title>
<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
  body { font-family: sans-serif; background:#f0f0f0; margin:0; }
  /* Header styling */
  .header {
    position: fixed; top:0; width:100%; height:60px; background:#fff; display:flex; align-items:center; justify-content:space-between; padding:0 20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); z-index:999;
  }
  .vendor-text { font-weight:bold; color:red; font-size:1.2em; }
.menu-container {
  display: flex;
  align-items: center;
  position: relative;
  margin-left: -20px; /* move the whole button more to the left */
}
  .profile-btn { background:#ff0000; color:#fff; padding:8px 12px; border:none; border-radius:50px; cursor:pointer; }
  .dropdown { display:none; position:absolute; right:20px; top:60px; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); min-width:200px; z-index:1000; }
  .dropdown.show { display:block; }
  .dropdown a { display:block; padding:10px 15px; text-decoration:none; color:#333; }
  .dropdown a:hover { background:#f0f0f0; }

  /* Container styles */
  .container {
    margin-top:80px; padding:20px; max-width:1200px; margin-left:auto; margin-right:auto; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  /* Management buttons */
  .management-buttons { margin-bottom:10px; }
  .management-buttons button { margin-right:5px; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; }
  .btn-primary { background:#f90101; color:#fff; }
  .btn-secondary { background:#f60202; color:#fff; }
  .btn-payment-history { background:#fa0303; color:#fff; }

  /* Sections */
  .section { display:none; }
  /* Tables styling */
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:8px; }
  th { background:#f0f0f0; }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="vendor-text">Vendor</div>
  <div class="menu-container">
    <button class="profile-btn" id="profileBtn" onclick="toggleDropdown()" style="margin-left:50px;">
      <i class="fas fa-user-circle"></i> Menu
    </button>
    <div class="dropdown" id="profileDropdown">
      <a href="#" onclick="showManagement('items');">Manage Items</a>
      <a href="#" onclick="showManagement('orders');">Manage Orders</a>
      <a href="#" onclick="showManagement('users');">Manage Users</a>
      <a href="#" onclick="showPaymentHistory()">Payment History</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container">
  <!-- Management Buttons -->
  <div class="management-buttons">
    <button class="btn-primary" onclick="showManagement('items')">Manage Items</button>
    <button class="btn-primary" onclick="showManagement('orders')">Manage Orders</button>
    <button class="btn-primary" onclick="showManagement('users')">Manage Users</button>
    <button class="btn-payment-history" onclick="showPaymentHistory()">Payment History</button>
  </div>

  <!-- Sections -->
  <div id="section-items" class="section">
    <h3>Items</h3>
    <button class="btn-secondary" onclick="openItemForm()">Add Item</button>
    <div id="itemsTable"></div>
  </div>
  <div id="section-orders" class="section">
    <h3>Orders</h3>
    <button class="btn-secondary" onclick="promptAddOrder()">Add Order</button>
    <div id="ordersTable"></div>
  </div>
  <div id="section-users" class="section">
    <h3>Users</h3>
    <button class="btn-secondary" onclick="openUserForm()">Add User</button>
    <div id="usersTable"></div>
  </div>
  <div id="section-payment-history" class="section">
    <h3>Payment History</h3>
    <button onclick="showPaymentHistory()">Refresh</button>
    <div id="paymentHistoryContainer"></div>
  </div>
</div>

<!-- Add/Edit Item Modal -->
<div id="itemFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="itemFormTitle">Add Item</h4>
    <input id="itemVendor" placeholder="Vendor" />
    <input id="itemName" placeholder="Item" />
    <input id="itemPrice" placeholder="Price" type="number" />
    <select id="itemStock">
      <option value="In Stock">In Stock</option>
      <option value="Out of Stock">Out of Stock</option>
    </select>
    <button onclick="saveItem()">Save</button>
    <button onclick="closeItemForm()">Cancel</button>
  </div>
</div>

<!-- Add/Edit User Modal -->
<div id="userFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="userFormTitle">Add User</h4>
    <input id="userEmail" placeholder="Email" />
    <input id="userName" placeholder="Name" />
    <button onclick="saveUser()">Save</button>
    <button onclick="closeUserForm()">Cancel</button>
  </div>
</div>

<!-- Notification -->
<div id="notification"></div>

<!-- Core Script -->
<script>
  // Initialize supabase (your URL and KEY)
  const supabaseUrl = 'https://wbpgmgtoyzlnawvsfeiu.supabase.co';
  const supabaseKey = 'process.env.SUPABASE_KEY'; // replace with your actual key
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Data arrays
  let items = [];
  let orders = [];
  let users = [];
  let payments = [];

  // Toggle dropdown menu
  function toggleDropdown() {
    document.getElementById('profileDropdown').classList.toggle('show');
  }

  // Show management sections
  function showManagement(type) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    if (type==='items') { document.getElementById('section-items').style.display='block'; renderItems(); }
    if (type==='orders') { document.getElementById('section-orders').style.display='block'; renderOrders(); }
    if (type==='users') { document.getElementById('section-users').style.display='block'; renderUsers(); }
  }

  // Show payment history
  function showPaymentHistory() {
    fetchPayments();
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById('section-payment-history').style.display='block';
  }

  // Fetch payment records from Supabase
  async function fetchPayments() {
    const { data, error } = await supabase
      .from('payment_history')
      .select('*')
      .order('date', { ascending: false });
    if (error) {
      console.error('Error fetching payments:', error);
      return;
    }
    payments = data.map(p => ({
      date: new Date(p.date).toISOString().split('T')[0],
      amount: parseFloat(p.amount),
      transactionId: p.transaction_id,
      status: p.status
    }));
    renderPaymentHistory();
  }

  // Render payment history table with Rands
  function renderPaymentHistory() {
    const container = document.getElementById('paymentHistoryContainer');
    container.innerHTML = '';

    if (payments.length === 0) {
      container.innerHTML = 'No payment history.';
      return;
    }

    const table = document.createElement('table');
    table.innerHTML = `<thead>
                          <tr>
                            <th>Date</th>
                            <th>Amount (ZAR)</th>
                            <th>Transaction ID</th>
                            <th>Status</th>
                          </tr>
                       </thead>`;
    const tbody = document.createElement('tbody');

    payments.forEach(p => {
      const row = tbody.insertRow();
      row.insertCell().innerText = `R ${p.amount.toFixed(2)}`;
      row.insertCell().innerText = p.date;
      row.insertCell().innerText = p.transactionId;
      row.insertCell().innerText = p.status;
    });

    table.appendChild(tbody);
    container.innerHTML = '';
    container.appendChild(table);
  }

  // Placeholder CRUD functions for items, orders, users
  function renderItems() { /* Your code here */ }
  function openItemForm() { /* Your code here */ }
  function saveItem() { /* Your code here */ }
  function closeItemForm() { /* Your code here */ }
  function editItem(i) { /* Your code here */ }
  function deleteItem(i) { /* Your code here */ }
  function renderOrders() { /* Your code here */ }
  function promptAddOrder() { /* Your code here */ }
  function editOrder(i) { /* Your code here */ }
  function deleteOrder(i) { /* Your code here */ }
  function renderUsers() { /* Your code here */ }
  function openUserForm() { /* Your code here */ }
  function saveUser() { /* Your code here */ }
  function closeUserForm() { /* Your code here */ }

  // Show section
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById(id).style.display='block';
  }

  // Logout
  function logout() {
    localStorage.clear();
    alert('Logged out');
  }

  // On page load
  window.onload = () => {
    // fetch payments initially
    fetchPayments();
  };
</script>
</body>
</html>