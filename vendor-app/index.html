<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vendor App</title>
<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
  body { font-family: sans-serif; background:#f0f0f0; margin:0; }
  /* Header styles */
  .header {
    position: fixed; top:0; width:100%; height:60px; background:#fff; display:flex; align-items:center; justify-content:space-between; padding:0 20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); z-index:999;
  }
  .vendor-text { font-weight:bold; color:red; font-size:1.2em; }
  .menu-container { display:flex; align-items:center; position:relative; }
  .profile-btn { background:#ff0000; color:#fff; padding:8px 12px; border:none; border-radius:50px; cursor:pointer; }
  .dropdown { display:none; position:absolute; right:20px; top:60px; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); min-width:200px; z-index:1000; }
  .dropdown.show { display:block; }
  .dropdown a { display:block; padding:10px 15px; text-decoration:none; color:#333; }
  .dropdown a:hover { background:#f0f0f0; }
  /* Container */
  .container {
    margin-top:80px; padding:20px; max-width:1200px; margin-left:auto; margin-right:auto; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  /* Management Buttons */
  .management-buttons { margin-bottom:10px; }
  .management-buttons button { margin-right:5px; }
  /* Sections */
  .section { display:none; }
  /* Buttons in management */
  button { padding:8px 12px; margin:5px; border:none; border-radius:4px; cursor:pointer; }
  .btn-primary { background:#f90101; color:#fff; }
  .btn-secondary { background:#f60202; color:#fff; }
  .btn-danger { background:#fc1302; color:#fff; }
  /* Tables */
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:8px; }
  th { background:#f0f0f0; }
  /* Modal overlay for forms */
  .modal {
    display:flex; align-items:center; justify-content:center; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;
  }
  .modal-box { background:#fff; padding:20px; border-radius:8px; width:400px; max-height:80%; overflow-y:auto; }
  /* Welcome overlay style */
  #welcomeOverlay {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.8);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:10000;
    text-align: center;
    padding:20px;
  }
  #welcomeOverlay img {
    max-width:250px;
    margin-bottom:20px;
  }
  #welcomeOverlay h2 {
    color: gray;
    margin: 10px 0;
  }
  #welcomeOverlay p {
    margin:10px 0;
  }
  /* Buttons in overlay */
  .centered-buttons {
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .centered-buttons button {
    width:200px;
    padding:12px;
    margin:10px 0;
    font-size:1em;
    cursor:pointer;
    border-radius:4px;
    border:none;
  }
  /* Specific overlay buttons */
  .btn-create {
    background:#f60202; /* red background */
    color:#fff;
  }
  .btn-login {
    background:#fff; /* white background */
    color:#f60202; /* red text */
  }
  .btn-browser {
    background:#f60202; /* red background */
    color:#fff; /* white text */
  }
  /* Terms and conditions text */
  #termsText {
    margin-top:20px;
    text-align:center;
    font-size:0.9em;
    color: #555;
  }
</style>
</head>
<body>


<!-- Header -->
<div class="header">
  <div class="vendor-text">Vendor</div>
  <div class="menu-container">
    <button class="profile-btn" id="profileBtn" onclick="toggleDropdown()"><i class="fas fa-user-circle"></i> Menu</button>
    <div class="dropdown" id="profileDropdown">
      <a href="#" onclick="showManagement('items');">Manage Items</a>
      <a href="#" onclick="showManagement('orders');">Manage Orders</a>
      <a href="#" onclick="showManagement('users');">Manage Users</a>
      <a href="#" onclick="showManagement('payment');">Manage Payments</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container">
  <!-- Management Buttons -->
  <div class="management-buttons">
    <button class="btn-primary" onclick="showManagement('items')">Manage Items</button>
    <button class="btn-primary" onclick="showManagement('orders')">Manage Orders</button>
    <button class="btn-primary" onclick="showManagement('users')">Manage Users</button>
    <button class="btn-primary" onclick="showManagement('payment')">Manage Payments</button>
  </div>

  <!-- Management Sections -->
  <div id="section-items" class="section">
    <h3>Items</h3>
    <button class="btn-secondary" onclick="openItemForm()">Add Item</button>
    <div id="itemsTable"></div>
  </div>
  <div id="section-orders" class="section">
    <h3>Orders</h3>
    <button class="btn-secondary" onclick="promptAddOrder()">Add Order</button>
    <div id="ordersTable"></div>
  </div>
  <div id="section-users" class="section">
    <h3>Users</h3>
    <button class="btn-secondary" onclick="openUserForm()">Add User</button>
    <div id="usersTable"></div>
  </div>
  <div id="section-payments" class="section">
    <h3>Payments</h3>
    <button class="btn-secondary" onclick="openPaymentForm()">Add Payment</button>
    <div id="paymentsTable"></div>
  </div>
</div>

<!-- Modals for Add/Edit -->
<div id="itemFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="itemFormTitle">Add Item</h4>
    <input id="itemVendor" placeholder="Vendor" />
    <input id="itemName" placeholder="Item" />
    <input id="itemPrice" placeholder="Price" type="number" />
    <select id="itemStock">
      <option value="In Stock">In Stock</option>
      <option value="Out of Stock">Out of Stock</option>
    </select>
    <button onclick="saveItem()">Save</button>
    <button onclick="closeItemForm()">Cancel</button>
  </div>
</div>
<div id="userFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="userFormTitle">Add User</h4>
    <input id="userEmail" placeholder="Email" />
    <input id="userName" placeholder="Name" />
    <button onclick="saveUser()">Save</button>
    <button onclick="closeUserForm()">Cancel</button>
  </div>
</div>
<div id="paymentFormModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h4 id="paymentFormTitle">Add Payment</h4>
    <input id="paymentAmount" placeholder="Amount" type="number" />
    <!-- Fixed method to EFT -->
    <select id="paymentMethod">
      <option value="EFT">EFT</option>
    </select>
    <button onclick="savePayment()">Save</button>
    <button onclick="closePaymentForm()">Cancel</button>
  </div>
</div>
<script type="text/babel" src="./src/index.jsx"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>

<!-- Add notification page / section with ringing sound -->

<script>
// =================== State & Utility ===================
let tempAdminData={}, generatedOTP='';

function init() {
  // Show registration modal first
  showRegistration();
}
window.onload = () => {
  // Check if user is already logged in
  if(localStorage.getItem('vendorLoggedIn')==='true'){
    document.getElementById('welcomeOverlay').style.display='none';
    showSection('section-items');
  } else {
    // stay on overlay until user clicks a button
  }
};

// Functions for overlay buttons
function handleCreateAccount() {
  document.getElementById('welcomeOverlay').style.display='none';
  showRegistration();
}
function handleLogin() {
  document.getElementById('welcomeOverlay').style.display='none';
  showLogin();
}
function showRegistration() {
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById('loginModal').style.display='none';
  document.getElementById('registerModal').style.display='none';
  document.getElementById('otpModal').style.display='none';
}
function showLogin() {
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById('loginModal').style.display='flex';
  document.getElementById('username').value='';
  document.getElementById('password').value='';
}
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display='none');
  document.getElementById(id).style.display='block';
}
function logout() {
  localStorage.clear();
  alert('Logged out');
  showRegistration(); // restart overlay
}

// Registration process
function startRegistration() {
  const email=document.getElementById('regEmail').value.trim();
  const name=document.getElementById('regName').value.trim();
  const pass=document.getElementById('regPassword').value.trim();
  if(!email || !name || !pass){ alert('Fill all fields'); return; }
  tempAdminData={email, name, pass};
  generatedOTP = Math.floor(100000 + Math.random()*900000).toString();
  alert('Your OTP: '+generatedOTP);
  document.getElementById('registerModal').style.display='none';
  document.getElementById('otpModal').style.display='flex';
  document.getElementById('otpInput').value='';
}
function verifyOTP() {
  const inputOTP=document.getElementById('otpInput').value.trim();
  if(inputOTP===generatedOTP){
    alert('OTP verified! Registration complete.');
    localStorage.setItem('vendorEmail', tempAdminData.email);
    localStorage.setItem('vendorPassword', tempAdminData.pass);
    localStorage.setItem('vendorLoggedIn','true');
    document.getElementById('otpModal').style.display='none';
    showSection('section-items');
  } else {
    alert('Incorrect OTP');
  }
}
function verifyLogin() {
  const username = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  const storedEmail = localStorage.getItem('vendorEmail');
  const storedPass = localStorage.getItem('vendorPassword');
  if (!storedEmail || !storedPass) { alert('Register first'); return; }
  if (username === storedEmail && pass === storedPass) {
    alert('Logged in');
    localStorage.setItem('vendorLoggedIn', 'true');
    document.getElementById('loginModal').style.display='none';
    showSection('section-items');
  } else {
    alert('Invalid');
  }
}

// Show management section
function showManagement(type) {
  document.querySelectorAll('.section').forEach(s => s.style.display='none');
  if(type==='items'){ document.getElementById('section-items').style.display='block'; renderItems(); }
  else if(type==='orders'){ document.getElementById('section-orders').style.display='block'; renderOrders(); }
  else if(type==='users'){ document.getElementById('section-users').style.display='block'; renderUsers(); }
  else if(type==='payment'){ document.getElementById('section-payments').style.display='block'; renderPayments(); }
}

// ----------- CRUD functions (your existing) -----------

// Items
let items = [];
function renderItems() {
  const container=document.getElementById('itemsTable');
  container.innerHTML='';
  if(items.length===0){ container.innerHTML='No items'; return; }
  const table=document.createElement('table');
  table.innerHTML=`<thead><tr><th>Vendor</th><th>Item</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead>`;
  const tbody=document.createElement('tbody');
  items.forEach((it,i)=>{
    const r=tbody.insertRow();
    r.insertCell().innerText=it.vendor;
    r.insertCell().innerText=it.item;
    r.insertCell().innerText=`R ${it.price.toFixed(2)}`;
    r.insertCell().innerText=it.stock;
    const act=r.insertCell();
    const editBtn=document.createElement('button'); editBtn.innerText='Edit'; editBtn.onclick=()=>editItem(i);
    const delBtn=document.createElement('button'); delBtn.innerText='Delete'; delBtn.style.background='#f44336'; delBtn.onclick=()=>{ items.splice(i,1); renderItems(); };
    act.appendChild(editBtn); act.appendChild(delBtn);
  });
  table.appendChild(tbody);
  container.appendChild(table);
}
function openItemForm() {
  document.getElementById('itemFormTitle').innerText='Add Item';
  document.getElementById('itemVendor').value='';
  document.getElementById('itemName').value='';
  document.getElementById('itemPrice').value='';
  document.getElementById('itemStock').value='In Stock';
  document.getElementById('itemFormModal').dataset.editIndex='-1';
  document.getElementById('itemFormModal').style.display='flex';
}
function editItem(i) {
  const it=items[i];
  document.getElementById('itemFormTitle').innerText='Edit Item';
  document.getElementById('itemVendor').value=it.vendor;
  document.getElementById('itemName').value=it.item;
  document.getElementById('itemPrice').value=it.price;
  document.getElementById('itemStock').value=it.stock;
  document.getElementById('itemFormModal').dataset.editIndex=i;
  document.getElementById('itemFormModal').style.display='flex';
}
function saveItem() {
  const i=Number(document.getElementById('itemFormModal').dataset.editIndex);
  const vendor=document.getElementById('itemVendor').value.trim();
  const item=document.getElementById('itemName').value.trim();
  const price=parseFloat(document.getElementById('itemPrice').value);
  const stock=document.getElementById('itemStock').value;
  if(!vendor || !item || isNaN(price)){ alert('Fill all fields'); return; }
  if(i>=0){ items[i]={vendor,item,price,stock}; } else { items.push({vendor,item,price,stock}); }
  closeItemForm(); renderItems();
}
function closeItemForm() { document.getElementById('itemFormModal').style.display='none'; }

// Orders
let orders = [];
function renderOrders() {
  const container=document.getElementById('ordersTable');
  container.innerHTML='';
  if(orders.length===0){ container.innerHTML='No orders'; return; }
  const table=document.createElement('table');
  table.innerHTML=`<thead><tr><th>ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>`;
  const tbody=document.createElement('tbody');
  orders.forEach((o,i)=>{
    const r=tbody.insertRow();
    r.insertCell().innerText=o.id;
    r.insertCell().innerText=o.customer;
    r.insertCell().innerText=`R ${o.total.toFixed(2)}`;
    r.insertCell().innerText=o.status;
    const act=r.insertCell();
    const editBtn=document.createElement('button'); editBtn.innerText='Edit'; editBtn.onclick=()=>editOrder(i);
    const delBtn=document.createElement('button'); delBtn.innerText='Delete'; delBtn.style.background='#f44336'; delBtn.onclick=()=>{ orders.splice(i,1); renderOrders(); };
    act.appendChild(editBtn); act.appendChild(delBtn);
  });
  table.appendChild(tbody);
  container.innerHTML=''; container.appendChild(table);
}
function promptAddOrder() {
  const customer=prompt('Customer name:');
  const totalStr=prompt('Total R:');
  const status=prompt('Status (Pending/Delivered):');
  const total=parseFloat(totalStr);
  if(!customer || isNaN(total) || !status){ alert('Invalid input'); return; }
  const newOrder={id:orders.length+1, customer, total, status};
  orders.push(newOrder);
  renderOrders();
}
function editOrder(i) {
  const o=orders[i];
  const newStatus=prompt('Set status:', o.status);
  if(newStatus){ o.status=newStatus; renderOrders(); }
}

// Users
let users = [];
function renderUsers() {
  const container=document.getElementById('usersTable');
  container.innerHTML='';
  if(users.length===0){ container.innerHTML='No users'; return; }
  const table=document.createElement('table');
  table.innerHTML=`<thead><tr><th>Email</th><th>Name</th><th>Actions</th></tr></thead>`;
  const tbody=document.createElement('tbody');
  users.forEach((u,i)=>{
    const r=tbody.insertRow();
    r.insertCell().innerText=u.email;
    r.insertCell().innerText=u.name;
    const act=r.insertCell();
    const editBtn=document.createElement('button'); editBtn.innerText='Edit'; editBtn.onclick=()=>editUser(i);
    const delBtn=document.createElement('button'); delBtn.innerText='Delete'; delBtn.style.background='#f44336'; delBtn.onclick=()=>{ users.splice(i,1); renderUsers(); };
    act.appendChild(editBtn); act.appendChild(delBtn);
  });
  table.appendChild(tbody);
  container.innerHTML=''; container.appendChild(table);
}
function openUserForm() {
  document.getElementById('userFormTitle').innerText='Add User';
  document.getElementById('userEmail').value='';
  document.getElementById('userName').value='';
  document.getElementById('userFormModal').dataset.editIndex='-1';
  document.getElementById('userFormModal').style.display='flex';
}
function editUser(i) {
  const u=users[i];
  document.getElementById('userFormTitle').innerText='Edit User';
  document.getElementById('userEmail').value=u.email;
  document.getElementById('userName').value=u.name;
  document.getElementById('userFormModal').dataset.editIndex=i;
  document.getElementById('userFormModal').style.display='flex';
}
function saveUser() {
  const i=Number(document.getElementById('userFormModal').dataset.editIndex);
  const email=document.getElementById('userEmail').value.trim();
  const name=document.getElementById('userName').value.trim();
  if(!email || !name){ alert('Fill all fields'); return; }
  if(i>=0){ users[i]= {email, name}; } else { users.push({email, name}); }
  closeUserForm(); renderUsers();
}
function closeUserForm() { document.getElementById('userFormModal').style.display='none'; }

// Payments
let payments = [];
function renderPayments() {
  const container=document.getElementById('paymentsTable');
  container.innerHTML='';
  if(payments.length===0){ container.innerHTML='No payments'; return; }
  const table=document.createElement('table');
  table.innerHTML=`<thead><tr><th>Amount</th><th>Method</th><th>Actions</th></tr></thead>`;
  const tbody=document.createElement('tbody');
  payments.forEach((p,i)=>{
    const r=tbody.insertRow();
    r.insertCell().innerText=`R ${p.amount.toFixed(2)}`;
    r.insertCell().innerText=p.method;
    const act=r.insertCell();
    const editBtn=document.createElement('button'); editBtn.innerText='Edit'; editBtn.onclick=()=>editPayment(i);
    const delBtn=document.createElement('button'); delBtn.innerText='Delete'; delBtn.style.background='#f44336'; delBtn.onclick=()=>{ payments.splice(i,1); renderPayments(); };
    act.appendChild(editBtn); act.appendChild(delBtn);
  });
  table.appendChild(tbody);
  container.innerHTML=''; container.appendChild(table);
}
function openPaymentForm() {
  document.getElementById('paymentFormTitle').innerText='Add Payment';
  document.getElementById('paymentAmount').value='';
  // Since method is fixed, no need to set value
  document.getElementById('paymentMethod').value='EFT';
  document.getElementById('paymentFormModal').dataset.editIndex='-1';
  document.getElementById('paymentFormModal').style.display='flex';
}
function editPayment(i) {
  const p=payments[i];
  document.getElementById('paymentFormTitle').innerText='Edit Payment';
  document.getElementById('paymentAmount').value=p.amount;
  document.getElementById('paymentMethod').value=p.method;
  document.getElementById('paymentFormModal').dataset.editIndex=i;
  document.getElementById('paymentFormModal').style.display='flex';
}
function savePayment() {
  const i=Number(document.getElementById('paymentFormModal').dataset.editIndex);
  const amount=parseFloat(document.getElementById('paymentAmount').value);
  const method='EFT'; // Fixed method
  if(isNaN(amount)){ alert('Fill all fields'); return; }
  if(i>=0){ payments[i]= {amount, method}; } else { payments.push({amount, method}); }
  closePaymentForm();
  renderPayments();
}
function closePaymentForm() { document.getElementById('paymentFormModal').style.display='none'; }

// ----------- Modal open/close functions for forms -----------

function openItemForm() {
  document.getElementById('itemFormTitle').innerText='Add Item';
  document.getElementById('itemVendor').value='';
  document.getElementById('itemName').value='';
  document.getElementById('itemPrice').value='';
  document.getElementById('itemStock').value='In Stock';
  document.getElementById('itemFormModal').dataset.editIndex='-1';
  document.getElementById('itemFormModal').style.display='flex';
}
function closeItemForm() { document.getElementById('itemFormModal').style.display='none'; }

function openUserForm() {
  document.getElementById('userFormTitle').innerText='Add User';
  document.getElementById('userEmail').value='';
  document.getElementById('userName').value='';
  document.getElementById('userFormModal').dataset.editIndex='-1';
  document.getElementById('userFormModal').style.display='flex';
}
function closeUserForm() { document.getElementById('userFormModal').style.display='none'; }

function openPaymentForm() {
  document.getElementById('paymentFormTitle').innerText='Add Payment';
  document.getElementById('paymentAmount').value='';
  // Set method to EFT
  document.getElementById('paymentMethod').value='EFT';
  document.getElementById('paymentFormModal').dataset.editIndex='-1';
  document.getElementById('paymentFormModal').style.display='flex';
}
function closePaymentForm() { document.getElementById('paymentFormModal').style.display='none'; }

// Toggle dropdown menu
function toggleDropdown() {
  const dropdown = document.getElementById('profileDropdown');
  dropdown.classList.toggle('show');
}

// Close dropdown if clicked outside
window.onclick = function(event) {
  if (!event.target.matches('.profile-btn')) {
    const dropdown = document.getElementById('profileDropdown');
    if (dropdown.classList.contains('show')) {
      dropdown.classList.remove('show');
    }
  }
};
</script>
</body>
</html>